{% extends "base.html" %}

{% block title %}AI Tweet Bot - Ana Sayfa{% endblock %}

<!-- Haber kaynaƒüƒ± g√∂sterimi i√ßin makro -->
{% macro render_source_badge(source, source_id, url, badge_type='primary') %}
    {% if source %}
        {% set source_class = 'source-badge-' + badge_type %}
        {% if 'techcrunch' in source.lower() %}
            {% set source_class = 'source-techcrunch' %}
        {% elif 'venturebeat' in source.lower() %}
            {% set source_class = 'source-venturebeat' %}
        {% elif 'wired' in source.lower() %}
            {% set source_class = 'source-wired' %}
        {% elif 'reddit' in source.lower() %}
            {% set source_class = 'source-reddit' %}
        {% elif 'economist' in source.lower() %}
            {% set source_class = 'source-economist' %}
        {% elif 'atlantic' in source.lower() %}
            {% set source_class = 'source-atlantic' %}
        {% elif 'guardian' in source.lower() %}
            {% set source_class = 'source-guardian' %}
        {% elif 'apple' in source.lower() %}
            {% set source_class = 'source-apple' %}
        {% elif 'hacker news' in source.lower() %}
            {% set source_class = 'source-hackernews' %}
        {% endif %}
        
            <div class="source-badge {{ source_class }}">
                <i class="fas fa-newspaper source-icon"></i>
                <span>Kaynak:</span>
                <span class="source-name">{{ source }}</span>
                {% if source_id %}
                <span class="source-id">{{ source_id }}</span>
                {% endif %}
        </div>
    {% elif url %}
        <!-- Fallback: URL'den kaynak adƒ±nƒ± √ßƒ±kar -->
        {% set fallback_source = '' %}
        {% set fallback_class = 'source-badge-fallback' %}
        
        {% if 'techcrunch.com' in url %}
            {% set fallback_source = 'TechCrunch' %}
            {% set fallback_class = 'source-techcrunch' %}
        {% elif 'venturebeat.com' in url %}
            {% set fallback_source = 'VentureBeat' %}
            {% set fallback_class = 'source-venturebeat' %}
        {% elif 'wired.com' in url %}
            {% set fallback_source = 'WIRED' %}
            {% set fallback_class = 'source-wired' %}
        {% elif 'reddit.com' in url %}
            {% set fallback_source = 'Reddit' %}
            {% set fallback_class = 'source-reddit' %}
        {% elif 'economist.com' in url %}
            {% set fallback_source = 'The Economist' %}
            {% set fallback_class = 'source-economist' %}
        {% elif 'theatlantic.com' in url %}
            {% set fallback_source = 'The Atlantic' %}
            {% set fallback_class = 'source-atlantic' %}
        {% elif 'theguardian.com' in url %}
            {% set fallback_source = 'The Guardian' %}
            {% set fallback_class = 'source-guardian' %}
        {% elif 'apple.com' in url %}
            {% set fallback_source = 'Apple Newsroom' %}
            {% set fallback_class = 'source-apple' %}
        {% else %}
            {% set fallback_source = url.split('//')[1].split('/')[0] if '//' in url else 'Bilinmeyen' %}
        {% endif %}
        
            <div class="source-badge {{ fallback_class }}">
                <i class="fas fa-globe source-icon"></i>
                <span>Kaynak:</span>
                <span class="source-name">{{ fallback_source }}</span>
                <span class="source-id">URL'den tespit</span>
        </div>
    {% endif %}
{% endmacro %}

{% block content %}
<!-- Twitter Feed Style -->
<div class="twitter-feed">
    <!-- Header -->
    <div class="feed-header">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h1 class="feed-title">Ana Sayfa</h1>
        </div>
        <div class="d-flex align-items-center gap-2">
                <button onclick="toggleAutoRefresh()" class="btn-minimal btn-minimal-secondary btn-minimal-sm">
                <i class="fas fa-sync" id="refresh-icon"></i>
                <span id="refresh-text">Auto</span>
            </button>
                <button onclick="location.reload();" class="btn-minimal btn-minimal-ghost btn-minimal-sm">
                    <i class="fas fa-sync-alt"></i>
            </button>
        </div>
            </div>
        </div>
        
    <!-- Feed Content - Scrollable Area -->
    <div class="feed-content">
        
    <!-- Otomasyon Durumu Tweet Card -->
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="tweet-user-info">
                <span class="tweet-username">AI Tweet Bot</span>
                <span class="tweet-handle">@aitweetbot</span>
                <span class="tweet-time">‚Ä¢ ≈ûimdi</span>
        </div>
            <div class="status-indicator status-online">
                <i class="fas fa-circle"></i> Aktif
                            </div>
                        </div>
        <div class="tweet-content">
            ü§ñ Sistem durumu: √áevrimi√ßi<br>
            üìä Bekleyen: {{ pending_tweets|length if pending_tweets else 0 }} tweet<br>
            ‚úÖ Payla≈üƒ±lan: {{ posted_count if posted_count else 0 }} tweet<br>
            üóëÔ∏è Reddedilen: {{ rejected_count if rejected_count else 0 }} tweet
                    </div>
                    
        <!-- Otomasyon Detaylarƒ± -->
        {% if automation_status %}
        <div class="tweet-footer">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <span class="text-secondary small me-2">Auto-refresh: 
                        <span class="text-success">Aktif</span>
                        </span>
                    <span class="text-secondary small">‚Ä¢ {{ automation_status.check_interval_hours }}h aralƒ±k</span>
                    </div>
            <div class="d-flex align-items-center">
                    <span class="text-secondary small me-2">Min Skor: {{ automation_status.min_score_threshold }}/10</span>
                    <span class="text-secondary small">‚Ä¢ Limit: {{ automation_status.max_articles_per_run or 5 }}</span>
                </div>
            </div>
            </div>
        {% endif %}
    </div>

    <!-- API Durumu Tweet Card -->
    {% if api_check %}
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                    <i class="fas fa-key"></i>
                </div>
            <div class="tweet-user-info">
                <span class="tweet-username">API Durumu</span>
                <span class="tweet-handle">@system</span>
                <span class="tweet-time">‚Ä¢ Kontrol</span>
            </div>
        </div>
        <div class="tweet-content">
            <div class="api-status-grid">
                <div class="api-status-item">
                    <i class="fas fa-brain text-primary"></i>
                    <span>OpenRouter AI:</span>
                    <span class="status-badge {{ 'status-success' if api_check.openrouter_api_available else 'status-error' }}">
                        {{ 'Mevcut' if api_check.openrouter_api_available else 'Eksik' }}
                                </span>
                            </div>
                <div class="api-status-item">
                    <i class="fab fa-twitter text-primary"></i>
                    <span>Twitter API:</span>
                    <span class="status-badge {{ 'status-success' if api_check.twitter_api_available else 'status-error' }}">
                        {{ 'Mevcut' if api_check.twitter_api_available else 'Eksik' }}
                                </span>
                            </div>
                <div class="api-status-item">
                    <i class="fas fa-eye text-info"></i>
                    <span>Google OCR:</span>
                    <span class="status-badge {{ 'status-success' if api_check.google_api_available else 'status-warning' }}">
                        {{ 'Mevcut' if api_check.google_api_available else 'Opsiyonel' }}
                                </span>
                            </div>
                <div class="api-status-item">
                    <i class="fab fa-telegram text-info"></i>
                    <span>Telegram:</span>
                    <span class="status-badge {{ 'status-success' if api_check.telegram_available else 'status-warning' }}">
                        {{ 'Mevcut' if api_check.telegram_available else 'Opsiyonel' }}
                                </span>
                            </div>
                                </div>
                            </div>
                        </div>
                {% endif %}

    <!-- Versiyon Bilgisi Tweet Card -->
        {% if app_version %}
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                <i class="fas fa-code-branch"></i>
                    </div>
            <div class="tweet-user-info">
                <span class="tweet-username">Versiyon Bilgisi</span>
                <span class="tweet-handle">@system</span>
                <span class="tweet-time">‚Ä¢ {{ app_release_date if app_release_date else 'G√ºncel' }}</span>
                </div>
                    </div>
        <div class="tweet-content">
            üì¶ Mevcut Versiyon: <strong>v{{ app_version }}</strong><br>
            üìÖ Yayƒ±n Tarihi: {{ app_release_date if app_release_date else 'Bilinmiyor' }}
                    {% if version_changelog and app_version in version_changelog %}
            <br>üìù Son Deƒüi≈üiklikler: {{ version_changelog[app_version][:150] }}...
                    {% endif %}
            <br>üîó <a href="{{ url_for('changelog') }}" class="text-primary text-decoration-none">T√ºm Deƒüi≈üiklikleri G√∂r√ºnt√ºle</a>
            </div>
        </div>
        {% endif %}

    <!-- Manuel Kontrol Tweet Card -->
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                <i class="fas fa-sync-alt"></i>
                    </div>
            <div class="tweet-user-info">
                <span class="tweet-username">Manuel Kontrol</span>
                <span class="tweet-handle">@manual</span>
                <span class="tweet-time">‚Ä¢ ≈ûimdi</span>
                </div>
                        </div>
        <div class="tweet-content">
            üîç Yeni haberleri manuel olarak kontrol etmek i√ßin a≈üaƒüƒ±daki butonu kullanƒ±n.
                        </div>
        <div class="tweet-actions">
            <button id="check-articles-btn" onclick="startArticleCheck()" class="btn-minimal btn-minimal-primary btn-minimal-sm">
                <i class="fas fa-sync-alt"></i>
                <span id="check-text">≈ûimdi Kontrol Et</span>
            </button>
            
            <!-- ƒ∞lerleme √áubuƒüu -->
            <div id="progress-container" class="mt-3" style="display: none;">
                <div class="progress-info d-flex justify-content-between align-items-center mb-2">
                    <span id="progress-step" class="text-primary fw-bold">Hazƒ±rlanƒ±yor...</span>
                    <span id="progress-percentage" class="text-muted small">0%</span>
                </div>
                <div class="progress" style="height: 8px;">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                </div>
                <div id="progress-message" class="text-muted small mt-1">Sistem ba≈ülatƒ±lƒ±yor...</div>
                <div id="progress-time" class="text-muted small">Tahmini s√ºre: --</div>
            </div>
        </div>
                        </div>

    <!-- Bekleyen Tweet'ler Ba≈ülƒ±ƒüƒ± -->
    {% if pending_tweets %}
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                        <i class="fas fa-clock"></i>
                    </div>
            <div class="tweet-user-info">
                <span class="tweet-username">Onay Bekleyen Tweet'ler</span>
                <span class="tweet-handle">@pending</span>
                <span class="tweet-time">‚Ä¢ {{ pending_tweets|length }} toplam</span>
                </div>
                    {% if news_count > 0 %}
            <div class="status-indicator status-online">
                <i class="fas fa-newspaper"></i> {{ news_count }} haber
            </div>
                    {% endif %}
                </div>
            </div>
    {% endif %}
                
        <!-- Toplu ƒ∞≈ülemler Paneli -->
    {% if pending_tweets %}
    <div class="tweet-card bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200">
        <div class="p-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <i class="fas fa-tasks text-primary me-2"></i>
                    <h5 class="mb-0 text-primary">Toplu ƒ∞≈ülemler</h5>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <button onclick="bulkApproveTweets()" class="btn-minimal btn-minimal-success btn-minimal-sm" id="bulk-approve-btn" disabled>
                        <i class="fas fa-check-double"></i> Toplu Onayla
                    </button>
                    <button onclick="bulkManualShare()" class="btn-minimal btn-minimal-primary btn-minimal-sm" id="bulk-manual-btn" disabled>
                        <i class="fas fa-external-link-alt"></i> Toplu Manuel Payla≈ü
                    </button>
                    <button onclick="bulkRejectTweets()" class="btn-minimal btn-minimal-danger btn-minimal-sm" id="bulk-reject-btn" disabled>
                        <i class="fas fa-times-circle"></i> Toplu Reddet
                    </button>
                </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
                <span class="text-muted small">Se√ßili tweet sayƒ±sƒ±: <span id="selected-count">0</span></span>
                {% if pending_tweets|length > 1 %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="select-all-tweets" onchange="toggleSelectAll()">
                    <label class="form-check-label small" for="select-all-tweets">
                        T√ºm√ºn√º Se√ß
                    </label>
                </div>
                {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
                
    <!-- Bekleyen Tweet'ler -->
    {% if pending_tweets %}
            {% for tweet in pending_tweets %}
            <!-- Tweet kalite kontrol√º -->
            {% set is_invalid_tweet = tweet.tweet_data and (tweet.tweet_data.get('is_valid') == false or (tweet.tweet_data.get('quality_score', 7) | int) <= 4) %}
            <div class="tweet-card {{ 'invalid-tweet' if is_invalid_tweet }}" 
                 data-tweet-id="{{ tweet.id }}" 
                 data-source-type="{{ tweet.source_type or 'news' }}"
                 data-tweet-valid="{{ 'false' if is_invalid_tweet else 'true' }}"
                 data-quality-score="{{ tweet.tweet_data.get('quality_score', 7) if tweet.tweet_data else 7 }}"
                 {% if is_invalid_tweet %}title="Bu tweet kalite kontrol√ºnden ge√ßemedi ve payla≈üƒ±lmayacak"{% endif %}>
                
                <div class="tweet-header">
                    <!-- Toplu ƒ∞≈ülem Checkbox -->
                    {% if pending_tweets|length > 1 %}
                    <div class="me-3">
                    <input type="checkbox" class="tweet-select-checkbox" 
                               value="{{ tweet.id }}" onchange="updateBulkButtons()">
                    </div>
                    {% endif %}
                    
                    <!-- Avatar -->
                    <div class="tweet-avatar">
                    <i class="fas fa-newspaper"></i>
                    </div>
                    
                    <!-- User Info -->
                    <div class="tweet-user-info">
                        <div class="d-flex align-items-center">
                        <span class="tweet-username">AI Haber Bot</span>
                        <span class="tweet-handle">@aihaberbot</span>
                            <span class="tweet-time">‚Ä¢ {{ tweet.created_at[:10] if tweet.created_at else 'Yeni' }}</span>
                        </div>
                        
                        <!-- Article Date -->
                        {% if tweet.article and tweet.article.article_date %}
                        <div class="article-date-info">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="article-date">Makale: {{ tweet.article.article_date[:10] }}</span>
                            {% if tweet.article.rss_published %}
                            <span class="article-time" title="{{ tweet.article.rss_published }}">{{ tweet.article.article_date[11:16] if tweet.article.article_date|length > 16 else '' }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        <!-- Kalite Kontrol G√∂stergesi -->
                        {% if tweet.tweet_data and tweet.tweet_data.quality_analysis %}
                            <div class="mt-1">
                                {% if is_invalid_tweet %}
                                <div class="d-flex align-items-center text-danger small">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    <span class="fw-medium">Kalite Problemi</span>
                                    <span class="status-indicator status-offline ms-2">
                                        {{ tweet.tweet_data.get('quality_score', 7) }}/10
                                    </span>
                                </div>
                                {% elif tweet.tweet_data.quality_analysis.warnings %}
                                <div class="d-flex align-items-center text-warning small">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    <span>Uyarƒ±: {{ tweet.tweet_data.quality_analysis.warnings[0] }}</span>
                                    <span class="status-indicator status-warning ms-2">
                                        {{ tweet.tweet_data.get('quality_score', 7) }}/10
                                    </span>
                                </div>
                                {% else %}
                                <div class="d-flex align-items-center text-success small">
                                    <i class="fas fa-check-circle me-1"></i>
                                    <span>Kalite: Y√ºksek</span>
                                    <span class="status-indicator status-online ms-2">
                                        {{ tweet.tweet_data.get('quality_score', 7) }}/10
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                        
                <!-- Tweet Content -->
                <div class="tweet-content">
                    <p>{{ tweet.content if tweet.content else 'Tweet metni bulunamadƒ±' }}</p>
                </div>
                
                <!-- Tweet Actions -->
                <div class="tweet-actions">
                    <!-- Character Count -->
                    <div class="tweet-action">
                        <i class="fas fa-text-width tweet-action-icon"></i>
                        <span>{{ (tweet.content or '')|length }}/280</span>
                        {% if (tweet.content or '')|length > 280 %}
                        <span class="text-danger ms-1">
                            <i class="fas fa-exclamation-triangle"></i>
                        </span>
                        {% elif (tweet.content or '')|length > 250 %}
                        <span class="text-warning ms-1">
                            <i class="fas fa-exclamation-circle"></i>
                        </span>
                        {% else %}
                        <span class="text-success ms-1">
                            <i class="fas fa-check-circle"></i>
                        </span>
                        {% endif %}
                    </div>
                            
                    <!-- Tweet Preview -->
                    <div class="btn-minimal btn-minimal-ghost btn-minimal-xs">
                        <i class="fas fa-eye"></i>
                        <span>√ñnizleme</span>
                    </div>
                    
                <!-- Makaleyi Oku -->
                {% if tweet.article and tweet.article.url %}
                <a href="{{ tweet.article.url }}" target="_blank" class="btn-minimal btn-minimal-info btn-minimal-xs" title="Orijinal makaleyi okumak i√ßin tƒ±klayƒ±n">
                    <i class="fas fa-external-link-alt"></i>
                    <span>Makaleyi Oku</span>
                </a>
                {% endif %}
                
                <!-- Onayla -->
                <button class="btn-minimal btn-minimal-success btn-minimal-xs" onclick="postTweet('{{ tweet.id }}')" {{ 'disabled' if is_invalid_tweet }}>
                    <i class="fas fa-check"></i>
                    <span>Onayla</span>
                </button>
                
                <!-- Manuel Payla≈ü -->
                <button class="btn-minimal btn-minimal-primary btn-minimal-xs" onclick="manualPostTweet('{{ tweet.id }}')" {{ 'disabled' if is_invalid_tweet }}>
                    <i class="fas fa-share"></i>
                    <span>Manuel Payla≈ü</span>
                        </button>
                
                <!-- Reddet -->
                <button class="btn-minimal btn-minimal-danger btn-minimal-xs" onclick="deleteTweet('{{ tweet.id }}')">
                    <i class="fas fa-trash"></i>
                    <span>Reddet</span>
                        </button>
                    </div>
                    
            <!-- Haber Kaynaƒüƒ± Badge'i -->
            <div class="tweet-footer">
                <div class="d-flex justify-content-between align-items-center">
                    {% if tweet.article and tweet.article.url %}
                        {{ render_source_badge(tweet.article.source, tweet.article.source_id, tweet.article.url) }}
                    {% else %}
                        <div class="source-badge source-badge-primary">
                            <i class="fas fa-newspaper source-icon"></i>
                            <span class="source-name">Haber Kaynaƒüƒ±</span>
                    </div>
                                        {% endif %}
                                    </div>
                                        </div>
                                        </div>
        {% endfor %}
                            {% endif %}
                            
    <!-- Reddedilen Makaleler - Sadece Link G√∂ster -->
    {% if rejected_articles and rejected_articles|length > 0 %}
    <div class="tweet-card">
        <div class="tweet-header">
            <div class="tweet-avatar">
                <i class="fas fa-ban"></i>
            </div>
            <div class="tweet-user-info">
                <span class="tweet-username">Reddedilen Makaleler</span>
                <span class="tweet-handle">@rejected</span>
                <span class="tweet-time">‚Ä¢ {{ rejected_articles|length }} makale</span>
            </div>
        </div>
        <div class="tweet-content">
            üìã Toplam {{ rejected_articles|length }} reddedilen makale bulunuyor.<br>
            üîó Bu makaleleri g√∂r√ºnt√ºlemek ve y√∂netmek i√ßin ayrƒ± sayfayƒ± ziyaret edin.
        </div>
        <div class="tweet-actions">
            <a href="{{ url_for('rejected_articles') }}" class="btn-minimal btn-minimal-danger btn-minimal-sm">
                <i class="fas fa-ban"></i>
                <span>Reddedilen Makaleleri G√∂r√ºnt√ºle</span>
            </a>
        </div>
    </div>
    {% endif %}
                
    <!-- Mesaj -->
    {% if not pending_tweets %}
            <div class="tweet-card">
                <div class="tweet-header">
                    <div class="tweet-avatar">
                <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="tweet-user-info">
                <span class="tweet-username">AI Tweet Bot</span>
                <span class="tweet-handle">@aitweetbot</span>
                <span class="tweet-time">‚Ä¢ ≈ûimdi</span>
                        </div>
                            </div>
                <div class="tweet-content">
            ‚úÖ T√ºm tweet'ler i≈ülendi!<br>
            üìã Bekleyen tweet bulunmuyor.<br>
            üîÑ Yeni haberler i√ßin kontrol devam ediyor.
                </div>
                    </div>
                                {% endif %}
                            </div>
    
    </div> <!-- End feed-content -->
</div> <!-- End twitter-feed -->

<script>
// Auto-refresh functionality
let autoRefreshInterval = null;
let isAutoRefreshEnabled = true;

function toggleAutoRefresh() {
    const button = document.querySelector('[onclick="toggleAutoRefresh()"]');
    const icon = document.getElementById('refresh-icon');
    const text = document.getElementById('refresh-text');
    
    isAutoRefreshEnabled = !isAutoRefreshEnabled;
    
    if (isAutoRefreshEnabled) {
        startAutoRefresh();
        icon.className = 'fas fa-sync me-1';
        text.textContent = 'Auto';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('twitter-btn-secondary');
    } else {
        stopAutoRefresh();
        icon.className = 'fas fa-pause me-1';
        text.textContent = 'Pause';
        button.classList.remove('twitter-btn-secondary');
        button.classList.add('btn-outline-secondary');
    }
}

function startAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
    autoRefreshInterval = setInterval(() => {
        refreshPendingTweets();
        updateTweetCounts();
    }, 30000); // 30 saniye
}

function stopAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
    }
}

// Bulk Operations Functions
document.addEventListener('DOMContentLoaded', function() {
    updateBulkButtons();
    startAutoRefresh();
});

function updateBulkButtons() {
    const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
    const bulkApproveBtn = document.getElementById('bulk-approve-btn');
    const bulkManualBtn = document.getElementById('bulk-manual-btn');
    const bulkRejectBtn = document.getElementById('bulk-reject-btn');
    const selectedCount = document.getElementById('selected-count');
    
    if (checkboxes.length > 0) {
        bulkApproveBtn.disabled = false;
        bulkManualBtn.disabled = false;
        bulkRejectBtn.disabled = false;
        } else {
        bulkApproveBtn.disabled = true;
        bulkManualBtn.disabled = true;
        bulkRejectBtn.disabled = true;
    }
    
    if (selectedCount) {
        selectedCount.textContent = checkboxes.length;
    }
}

function bulkApproveTweets() {
    const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
    const tweetIds = Array.from(checkboxes).map(cb => cb.value);
    
    if (tweetIds.length === 0) {
        showToast('L√ºtfen en az bir tweet se√ßin!', 'warning');
            return;
        }
        
    showConfirmDialog(
        `${tweetIds.length} tweet'i toplu olarak onaylamak istediƒüinizden emin misiniz?`,
        () => bulkProcessTweets(tweetIds, 'approve'),
        null,
        'Toplu Onaylama',
        'warning'
    );
}

function bulkManualShare() {
    const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
    const tweetIds = Array.from(checkboxes).map(cb => cb.value);
    
    if (tweetIds.length === 0) {
        showToast('L√ºtfen en az bir tweet se√ßin!', 'warning');
        return;
    }
    
    if (tweetIds.length > 10) {
        showToast('Aynƒ± anda maksimum 10 tweet payla≈üabilirsiniz!', 'warning');
        return;
    }
    
    showConfirmDialog(
        `${tweetIds.length} tweet'i manuel payla≈üƒ±m i√ßin hazƒ±rlayalƒ±m.\n\nüåü Popup blocker sorununu √∂nlemek i√ßin her tweet i√ßin tƒ±klanabilir butonlar olu≈üturacaƒüƒ±z.\n\nüì± Her butona tek tek tƒ±klayarak Twitter sayfalarƒ±nƒ± a√ßabilirsiniz.`,
        () => createManualShareInterface(tweetIds),
        null,
        'Popup Blocker G√ºvenli Payla≈üƒ±m',
        'info'
    );
}

function bulkRejectTweets() {
    const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
    const tweetIds = Array.from(checkboxes).map(cb => cb.value);
    
    if (tweetIds.length === 0) {
        showToast('L√ºtfen en az bir tweet se√ßin!', 'warning');
        return;
    }
    
    showConfirmDialog(
        `${tweetIds.length} tweet'i toplu olarak reddetmek istediƒüinizden emin misiniz?`,
        () => bulkProcessTweets(tweetIds, 'reject'),
        null,
        'Toplu Reddetme',
        'danger'
    );
}

function createManualShareInterface(tweetIds) {
    const button = document.getElementById('bulk-manual-btn');
    const originalText = button.innerHTML;
    
    // Loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Hazƒ±rlanƒ±yor...';
    button.disabled = true;
    
    // Get tweet data first
    fetch('/api/get_tweets_for_manual_share', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ tweet_ids: tweetIds })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.tweets && data.tweets.length > 0) {
            showPopupBlockerSafeInterface(data.tweets, tweetIds);
        } else {
            showToast(`Hata: ${data.error || 'Tweet verileri alƒ±namadƒ±'}`, 'error');
        }
        
        // Restore button
        button.innerHTML = originalText;
        button.disabled = false;
    })
    .catch(error => {
        console.error('Manual share interface error:', error);
        showToast('Tweet verileri alƒ±nƒ±rken hata olu≈ütu!', 'error');
        
        // Restore button
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

function showPopupBlockerSafeInterface(tweets, tweetIds) {
    // Create full-screen modal interface
    const modal = document.createElement('div');
    modal.className = 'manual-share-interface';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        z-index: 10002;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    `;
    
    const header = document.createElement('div');
    header.style.cssText = `
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    `;
    
    header.innerHTML = `
        <h2 style="margin: 0 0 10px 0; color: #333; font-size: 24px;">üöÄ Manuel Twitter Payla≈üƒ±m Interface</h2>
        <p style="margin: 0; color: #666; font-size: 16px;">
            ${tweets.length} tweet hazƒ±r! Her butona tƒ±klayarak Twitter sayfalarƒ±nƒ± tek tek a√ßabilirsiniz.
        </p>
        <div style="margin-top: 15px;">
            <button id="closeInterface" style="
                background: #ff6b6b;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                margin-right: 10px;
            ">‚úï Kapat</button>
            <button id="markAllPosted" style="
                background: #51cf66;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
            ">‚úÖ Hepsini Payla≈üƒ±ldƒ± ƒ∞≈üaretle</button>
        </div>
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
        align-content: start;
    `;
    
    tweets.forEach((tweet, index) => {
        const tweetContent = tweet.content || `Tweet payla≈üƒ±mƒ±: ${tweet.title || 'Haber payla≈üƒ±mƒ±'}`;
        const cleanTweetText = tweetContent.substring(0, 280);
        const tweetText = encodeURIComponent(cleanTweetText);
        const twitterUrl = `https://twitter.com/intent/tweet?text=${tweetText}`;
        
        const tweetCard = document.createElement('div');
        tweetCard.style.cssText = `
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        `;
        
        tweetCard.innerHTML = `
            <div style="margin-bottom: 16px;">
                <div style="
                    background: linear-gradient(45deg, #1da1f2, #1991db);
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    display: inline-block;
                    font-weight: 600;
                    font-size: 14px;
                    margin-bottom: 12px;
                ">
                    üì± Tweet ${index + 1}
                </div>
            </div>
            
            <div style="
                background: #f8f9fa;
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 20px;
                border-left: 4px solid #1da1f2;
            ">
                <div style="
                    font-size: 15px;
                    line-height: 1.5;
                    color: #333;
                    max-height: 100px;
                    overflow-y: auto;
                ">
                    ${cleanTweetText}
                </div>
                <div style="
                    margin-top: 8px;
                    font-size: 12px;
                    color: #666;
                ">
                    ${cleanTweetText.length}/280 karakter
                </div>
            </div>
            
            <button class="open-twitter-btn" data-url="${twitterUrl}" data-index="${index}" style="
                width: 100%;
                background: linear-gradient(45deg, #1da1f2, #1991db);
                color: white;
                border: none;
                padding: 16px;
                border-radius: 12px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            ">
                üê¶ Twitter'da Payla≈ü
            </button>
            
            <div class="tweet-status" style="
                margin-top: 12px;
                text-align: center;
                font-size: 14px;
                color: #666;
                opacity: 0;
                transition: opacity 0.3s ease;
            ">
                ‚úÖ Twitter sayfasƒ± a√ßƒ±ldƒ±!
            </div>
        `;
        
        content.appendChild(tweetCard);
    });
    
    modal.appendChild(header);
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Event listeners
    modal.querySelector('#closeInterface').addEventListener('click', () => {
        modal.remove();
    });
    
    modal.querySelector('#markAllPosted').addEventListener('click', () => {
        markTweetsAsPosted(tweetIds);
        modal.remove();
    });
    
    // Twitter button handlers
    modal.querySelectorAll('.open-twitter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const url = btn.getAttribute('data-url');
            const index = btn.getAttribute('data-index');
            
            // Open Twitter in new tab - this works because it's user initiated
            window.open(url, `twitter_share_${index}`, 'width=600,height=600,scrollbars=yes,resizable=yes');
            
            // Update button state
            btn.style.background = 'linear-gradient(45deg, #51cf66, #40c057)';
            btn.innerHTML = '‚úÖ Twitter Sayfasƒ± A√ßƒ±ldƒ±!';
            btn.disabled = true;
            
            // Show status message
            const status = btn.parentElement.querySelector('.tweet-status');
            status.style.opacity = '1';
            
            // Add hover effect
            btn.style.transform = 'scale(0.98)';
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
            }, 150);
        });
        
        // Hover effects
        btn.addEventListener('mouseenter', () => {
            if (!btn.disabled) {
                btn.style.transform = 'translateY(-2px)';
                btn.style.boxShadow = '0 8px 25px rgba(29, 161, 242, 0.3)';
            }
        });
        
        btn.addEventListener('mouseleave', () => {
            if (!btn.disabled) {
                btn.style.transform = 'translateY(0)';
                btn.style.boxShadow = 'none';
            }
        });
    });
    
    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .manual-share-interface > div {
            animation: slideInFromTop 0.6s ease-out forwards;
        }
        
        .manual-share-interface > div:nth-child(2) {
            animation-delay: 0.1s;
        }
    `;
    document.head.appendChild(style);
}

function bulkManualShareTweets(tweetIds) {
    const button = document.getElementById('bulk-manual-btn');
    const originalText = button.innerHTML;
    
    // Loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> A√ßƒ±lƒ±yor...';
    button.disabled = true;
    
    showToast(`${tweetIds.length} Twitter sayfasƒ± a√ßƒ±lƒ±yor...`, 'info');
    
    console.log('üîç Debug - Tweet IDs:', tweetIds); // Debug log
    
    // Get tweet data and open tabs
    fetch('/api/get_tweets_for_manual_share', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ tweet_ids: tweetIds })
    })
    .then(response => {
        console.log('üîç Debug - Response status:', response.status); // Debug log
        return response.json();
    })
    .then(data => {
        console.log('üîç Debug - Response data:', data); // Debug log
        
        if (data.success && data.tweets && data.tweets.length > 0) {
            console.log(`üîç Debug - Opening ${data.tweets.length} tabs`); // Debug log
            
            // Open tabs with delay to avoid popup blocking
            let delay = 100; // Start immediately
            const DELAY_BETWEEN_TABS = 800; // Longer delay for better handling
            
            data.tweets.forEach((tweet, index) => {
                setTimeout(() => {
                    console.log(`üîç Debug - Opening tab ${index + 1} for tweet:`, tweet); // Debug log
                    
                    // Ensure we have tweet content
                    let tweetContent = tweet.content;
                    if (!tweetContent || tweetContent.trim() === '') {
                        tweetContent = `Tweet payla≈üƒ±mƒ±: ${tweet.title || 'Haber payla≈üƒ±mƒ±'}`;
                    }
                    
                    // Clean and encode tweet text
                    const cleanTweetText = tweetContent.substring(0, 280); // Twitter limit
                    const tweetText = encodeURIComponent(cleanTweetText);
                    const twitterUrl = `https://twitter.com/intent/tweet?text=${tweetText}`;
                    
                    console.log(`üîç Debug - Opening URL: ${twitterUrl.substring(0, 100)}...`); // Debug log
                    
                    // Open in new tab with specific window features to prevent blocking
                    const newWindow = window.open(twitterUrl, `twitter_share_${index}`, 'width=600,height=400,scrollbars=yes,resizable=yes');
                    
                    if (newWindow) {
                        console.log(`‚úÖ Tab ${index + 1} opened successfully`);
                        // Show progress
                        if (index < data.tweets.length - 1) {
                            showToast(`${index + 1}/${data.tweets.length} Twitter sayfasƒ± a√ßƒ±ldƒ±...`, 'info');
                        } else {
                            showToast(`T√ºm ${data.tweets.length} Twitter sayfasƒ± a√ßƒ±ldƒ±!`, 'success');
                        }
                    } else {
                        console.error(`‚ùå Tab ${index + 1} blocked by popup blocker`);
                        showToast(`Popup blocker ${index + 1}. sekmeyi engelledi`, 'warning');
                    }
                    
                }, delay);
                delay += DELAY_BETWEEN_TABS;
            });
            
            // Show final instruction after all tabs are opened
            setTimeout(() => {
                showConfirmDialog(
                    `${data.tweets.length} Twitter compose sayfasƒ± a√ßƒ±ldƒ±.\n\nüìù Her sayfada tweet metni otomatik dolduruldu.\n‚úÖ Her sayfada "Tweet" butonuna tƒ±klayarak payla≈üabilirsiniz.\n\nüîÑ Payla≈ütƒ±ƒüƒ±nƒ±z tweetleri "payla≈üƒ±ldƒ±" olarak i≈üaretlemek ister misiniz?`,
                    () => markTweetsAsPosted(tweetIds),
                    () => showManualShareLinks(data.tweets), // Alternatif: Manuel linkler g√∂ster
                    'Tweetler Hazƒ±r',
                    'success'
                );
            }, delay + 1000);
            
        } else {
            showToast(`Hata: ${data.error || 'Tweet verileri alƒ±namadƒ±'}`, 'error');
            
            // If API failed, show alternative method
            if (!data.tweets || data.tweets.length === 0) {
                showConfirmDialog(
                    'Tweet verileri alƒ±namadƒ±.\n\nAlternatif olarak manuel payla≈üƒ±m linklerini g√∂rmek ister misiniz?',
                    () => {
                        // Create fallback tweets from selected checkboxes
                        const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
                        const fallbackTweets = Array.from(checkboxes).map((cb, index) => {
                            const tweetCard = cb.closest('.tweet-card');
                            const content = tweetCard.querySelector('.tweet-content p')?.textContent || `Tweet ${index + 1}`;
                            return {
                                id: cb.value,
                                content: content,
                                title: `Tweet ${index + 1}`
                            };
                        });
                        showManualShareLinks(fallbackTweets);
                    },
                    null,
                    'Alternatif Payla≈üƒ±m',
                    'info'
                );
            }
        }
        
        // Restore button
        button.innerHTML = originalText;
        button.disabled = false;
    })
    .catch(error => {
        console.error('Bulk manual share error:', error);
        showToast('Tweet verileri alƒ±nƒ±rken hata olu≈ütu!', 'error');
        
        // Show alternative method on error
        showConfirmDialog(
            'Baƒülantƒ± hatasƒ± olu≈ütu.\n\nAlternatif olarak manuel payla≈üƒ±m linklerini g√∂rmek ister misiniz?',
            () => {
                // Create fallback tweets from selected checkboxes
                const checkboxes = document.querySelectorAll('.tweet-select-checkbox:checked');
                const fallbackTweets = Array.from(checkboxes).map((cb, index) => {
                    const tweetCard = cb.closest('.tweet-card');
                    const content = tweetCard.querySelector('.tweet-content p')?.textContent || `Tweet ${index + 1}`;
                    return {
                        id: cb.value,
                        content: content,
                        title: `Tweet ${index + 1}`
                    };
                });
                showManualShareLinks(fallbackTweets);
            },
            null,
            'Baƒülantƒ± Hatasƒ±',
            'warning'
        );
        
        // Restore button
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

function showManualShareLinks(tweets) {
    // Create a modal with direct Twitter links
    const modal = document.createElement('div');
    modal.className = 'manual-share-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
    `;
    
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 70vh;
        overflow-y: auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    `;
    
    let linksHtml = `
        <h3 style="margin: 0 0 20px 0; color: #333;">üê¶ Manuel Twitter Payla≈üƒ±m Linkleri</h3>
        <p style="color: #666; margin-bottom: 20px;">Her linke tƒ±klayarak tweet'leri manuel olarak payla≈üabilirsiniz:</p>
        <div style="max-height: 300px; overflow-y: auto;">
    `;
    
    tweets.forEach((tweet, index) => {
        const tweetContent = tweet.content || `Tweet payla≈üƒ±mƒ±: ${tweet.title || 'Haber payla≈üƒ±mƒ±'}`;
        const cleanTweetText = tweetContent.substring(0, 280);
        const tweetText = encodeURIComponent(cleanTweetText);
        const twitterUrl = `https://twitter.com/intent/tweet?text=${tweetText}`;
        
        linksHtml += `
            <div style="
                padding: 12px;
                border: 1px solid #e1e8ed;
                border-radius: 8px;
                margin-bottom: 10px;
                background: #f8f9fa;
            ">
                <div style="font-weight: 600; color: #333; margin-bottom: 8px;">Tweet ${index + 1}:</div>
                <div style="font-size: 14px; color: #666; margin-bottom: 10px; line-height: 1.4;">
                    ${cleanTweetText}
                </div>
                <a href="${twitterUrl}" target="_blank" style="
                    display: inline-block;
                    background: #1da1f2;
                    color: white;
                    padding: 8px 16px;
                    border-radius: 6px;
                    text-decoration: none;
                    font-size: 14px;
                    font-weight: 500;
                ">
                    üê¶ Twitter'da Payla≈ü
                </a>
            </div>
        `;
    });
    
    linksHtml += `
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button id="closeLinksModal" style="
                background: #657786;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
            ">Kapat</button>
        </div>
    `;
    
    modalContent.innerHTML = linksHtml;
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    
    // Close button event
    modal.querySelector('#closeLinksModal').addEventListener('click', () => {
        modal.remove();
    });
    
    // Click outside to close
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

function markTweetsAsPosted(tweetIds) {
    fetch('/api/mark_tweets_as_posted', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ tweet_ids: tweetIds })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(`${tweetIds.length} tweet "payla≈üƒ±ldƒ±" olarak i≈üaretlendi!`, 'success');
            setTimeout(() => location.reload(), 1500);
        } else {
            showToast(`Hata: ${data.error || 'ƒ∞≈üaretleme ba≈üarƒ±sƒ±z'}`, 'error');
        }
    })
    .catch(error => {
        console.error('Mark as posted error:', error);
        showToast('ƒ∞≈üaretleme sƒ±rasƒ±nda hata olu≈ütu!', 'error');
    });
}

function bulkProcessTweets(tweetIds, action) {
    const button = action === 'approve' ? document.getElementById('bulk-approve-btn') : document.getElementById('bulk-reject-btn');
        const originalText = button.innerHTML;
    
    // Loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> ƒ∞≈üleniyor...';
    button.disabled = true;
    
    fetch('/bulk_tweet_action', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({
            tweet_ids: tweetIds,
            action: action
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(`${tweetIds.length} tweet ba≈üarƒ±yla ${action === 'approve' ? 'onaylandƒ±' : 'reddedildi'}!`, 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showToast(`Hata: ${data.error || 'Bilinmeyen hata olu≈ütu'}`, 'error');
            button.innerHTML = originalText;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('Fetch error:', error);
        showToast('ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu!', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById('select-all-tweets');
    const tweetCheckboxes = document.querySelectorAll('.tweet-select-checkbox');
    
    if (selectAllCheckbox && tweetCheckboxes.length > 0) {
        tweetCheckboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
        });
        
        updateBulkButtons();
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + A: Select all tweets (when in bulk mode)
    if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
        e.preventDefault();
        const selectAllCheckbox = document.getElementById('select-all-tweets');
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = !selectAllCheckbox.checked;
            toggleSelectAll();
        }
    }
});

// Individual tweet functions
function postTweet(tweetId) {
    showConfirmDialog(
        'Bu tweet\'i onaylamak istediƒüinizden emin misiniz?',
        () => {
            fetch('/post_tweet', {
        method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({ tweet_id: tweetId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(data.message || 'Tweet ba≈üarƒ±yla onaylandƒ±!', 'success');
            if (data.should_refresh) {
                setTimeout(() => location.reload(), 1500);
            }
        } else {
            showToast(`Hata: ${data.error || 'Bilinmeyen hata olu≈ütu'}`, 'error');
        }
    })
    .catch(error => {
                console.error('Error:', error);
                showToast('ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu!', 'error');
            });
        },
        null,
        'Tweet Onaylama',
        'warning'
    );
}

function manualPostTweet(tweetId) {
    showConfirmDialog(
        'Bu tweet\'i manuel olarak payla≈ümak istediƒüinizden emin misiniz?',
        () => {
            fetch('/manual_post_tweet', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
            },
                body: JSON.stringify({ tweet_id: tweetId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast(data.message || 'Tweet manuel olarak payla≈üƒ±ldƒ±!', 'success');
                if (data.should_refresh) {
                    setTimeout(() => location.reload(), 1500);
                }
            } else {
                showToast(`Hata: ${data.error || 'Bilinmeyen hata olu≈ütu'}`, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
                showToast('ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu!', 'error');
            });
        },
        null,
        'Manuel Payla≈üƒ±m',
        'info'
    );
}

function deleteTweet(tweetId) {
    showConfirmDialog(
        'Bu tweet\'i reddetmek istediƒüinizden emin misiniz?',
        () => {
        fetch('/delete_tweet', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
            },
                body: JSON.stringify({ tweet_id: tweetId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast(data.message || 'Tweet reddedildi!', 'success');
                if (data.should_refresh) {
                    setTimeout(() => location.reload(), 1500);
                }
            } else {
                showToast(`Hata: ${data.error || 'Bilinmeyen hata olu≈ütu'}`, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
                showToast('ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu!', 'error');
            });
        },
        null,
        'Tweet Reddetme',
        'danger'
    );
}

// Manuel kontrol fonksiyonu
function startArticleCheck() {
    const button = document.getElementById('check-articles-btn');
    const originalText = button.innerHTML;
    const progressContainer = document.getElementById('progress-container');
    
    // Loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Kontrol Ediliyor...';
    button.disabled = true;
    
    // ƒ∞lerleme √ßubuƒüunu g√∂ster
    progressContainer.style.display = 'block';
    
    // ƒ∞lerleme takibini ba≈ülat
    let progressInterval = setInterval(updateProgressUI, 500);
    
    fetch('/check_articles', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        // ƒ∞lerleme takibini durdur
        clearInterval(progressInterval);
        progressContainer.style.display = 'none';
        
        if (data.success) {
            showToast(data.message, 'success');
            if (data.should_refresh) {
                setTimeout(() => location.reload(), 2000);
            }
        } else {
            showToast(`Hata: ${data.error || 'Bilinmeyen hata olu≈ütu'}`, 'error');
        }
        button.innerHTML = originalText;
        button.disabled = false;
    })
    .catch(error => {
        // ƒ∞lerleme takibini durdur
        clearInterval(progressInterval);
        progressContainer.style.display = 'none';
        
        console.error('Error:', error);
        showToast('Kontrol sƒ±rasƒ±nda hata olu≈ütu!', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

// ƒ∞lerleme UI'sƒ±nƒ± g√ºncelle
function updateProgressUI() {
    fetch('/api/progress')
        .then(response => response.json())
        .then(data => {
            const progressStep = document.getElementById('progress-step');
            const progressPercentage = document.getElementById('progress-percentage');
            const progressBar = document.getElementById('progress-bar');
            const progressMessage = document.getElementById('progress-message');
            const progressTime = document.getElementById('progress-time');
            
            if (data.is_running) {
                // ƒ∞lerleme y√ºzdesini hesapla
                let percentage = 0;
                if (data.total_steps > 0 && data.current_step_number > 0) {
                    percentage = Math.round((data.current_step_number / data.total_steps) * 100);
                }
                
                // UI'ƒ± g√ºncelle
                progressStep.textContent = data.current_step;
                progressPercentage.textContent = `${percentage}%`;
                progressBar.style.width = `${percentage}%`;
                progressMessage.textContent = data.message;
                
                // Tahmini s√ºreyi g√∂ster
                if (data.estimated_time > 0) {
                    const minutes = Math.ceil(data.estimated_time / 60);
                    progressTime.textContent = `Tahmini s√ºre: ${minutes} dakika`;
                } else {
                    progressTime.textContent = 'Tahmini s√ºre: --';
                }
            } else {
                // ƒ∞≈ülem tamamlandƒ±ysa gizle
                document.getElementById('progress-container').style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Progress update error:', error);
        });
}


// Pending tweets b√∂l√ºm√ºn√º dinamik olarak yenile
function refreshPendingTweets() {
    fetch('/api/get_pending_tweets')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const pendingContainer = document.querySelector('#pending-tweets-container');
                if (pendingContainer && data.html) {
                    pendingContainer.innerHTML = data.html;
                    updateTweetCounts();
                }
            }
        })
        .catch(error => {
            console.error('Pending tweets yenileme hatasƒ±:', error);
        });
}

// Tweet sayƒ±larƒ±nƒ± g√ºncelle
function updateTweetCounts() {
    fetch('/api/get_tweet_counts')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Sayƒ±larƒ± g√ºncelle
                const pendingElements = document.querySelectorAll('[data-stat="pending_tweets"]');
                pendingElements.forEach(el => {
        el.textContent = data.stats.pending_tweets || 0;
    });
            }
        })
        .catch(error => {
            console.error('Tweet sayƒ±larƒ± g√ºncelleme hatasƒ±:', error);
        });
}

// Toast bildirimleri
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container') || createToastContainer();
    
    const toast = document.createElement('div');
    toast.className = `toast toast-${type} show`;
    toast.innerHTML = `
        <div class="toast-header">
            <i class="fas fa-${getToastIcon(type)} me-2"></i>
            <strong class="me-auto">${getToastTitle(type)}</strong>
            <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // 5 saniye sonra otomatik kaldƒ±r
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 5000);
}

// Modern Confirm Dialog Sistemi
function showConfirmDialog(message, onConfirm, onCancel = null, title = 'Onay Gerekli', type = 'warning') {
    // Mevcut dialog varsa kaldƒ±r
    const existingDialog = document.getElementById('confirm-dialog');
    if (existingDialog) {
        existingDialog.remove();
    }
    
    const dialog = document.createElement('div');
    dialog.id = 'confirm-dialog';
    dialog.className = 'confirm-dialog-overlay';
    dialog.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s ease-out;
    `;
    
    const icon = type === 'danger' ? 'exclamation-triangle' : 
                 type === 'success' ? 'check-circle' : 
                 type === 'info' ? 'info-circle' : 'question-circle';
    
    const iconColor = type === 'danger' ? '#dc3545' : 
                      type === 'success' ? '#28a745' : 
                      type === 'info' ? '#17a2b8' : '#ffc107';
    
    dialog.innerHTML = `
        <div class="confirm-dialog" style="
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
        ">
            <div style="text-align: center; margin-bottom: 20px;">
                <i class="fas fa-${icon}" style="font-size: 48px; color: ${iconColor}; margin-bottom: 16px;"></i>
                <h3 style="margin: 0; color: #333; font-size: 18px; font-weight: 600;">${title}</h3>
            </div>
            <div style="
                color: #666;
                line-height: 1.5;
                margin-bottom: 24px;
                text-align: center;
                white-space: pre-line;
            ">${message}</div>
            <div style="
                display: flex;
                gap: 12px;
                justify-content: center;
            ">
                <button id="confirm-cancel" style="
                    padding: 10px 20px;
                    border: 1px solid #ddd;
                    background: white;
                    color: #666;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.2s;
                " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
                    ƒ∞ptal
                </button>
                <button id="confirm-ok" style="
                    padding: 10px 20px;
                    border: none;
                    background: ${iconColor};
                    color: white;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 500;
                    transition: all 0.2s;
                " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                    Onayla
            </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(dialog);
    
    // Event listeners
    const cancelBtn = dialog.querySelector('#confirm-cancel');
    const okBtn = dialog.querySelector('#confirm-ok');
    
    const closeDialog = () => {
        dialog.style.animation = 'fadeOut 0.2s ease-in';
        setTimeout(() => dialog.remove(), 200);
    };
    
    cancelBtn.addEventListener('click', () => {
        closeDialog();
        if (onCancel) onCancel();
    });
    
    okBtn.addEventListener('click', () => {
        closeDialog();
        if (onConfirm) onConfirm();
    });
    
    // ESC tu≈üu ile kapatma
    const handleEsc = (e) => {
        if (e.key === 'Escape') {
            document.removeEventListener('keydown', handleEsc);
            closeDialog();
            if (onCancel) onCancel();
        }
    };
    document.addEventListener('keydown', handleEsc);
    
    // Dƒ±≈üarƒ± tƒ±klayarak kapatma
    dialog.addEventListener('click', (e) => {
        if (e.target === dialog) {
            closeDialog();
            if (onCancel) onCancel();
        }
    });
}

// CSS Animasyonlarƒ±
const confirmDialogStyle = document.createElement('style');
confirmDialogStyle.textContent = `
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    @keyframes slideIn {
        from { transform: scale(0.9); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
`;
document.head.appendChild(confirmDialogStyle);

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.className = 'toast-container';
    document.body.appendChild(container);
    return container;
}

function getToastIcon(type) {
    switch (type) {
        case 'success': return 'check-circle';
        case 'error': return 'exclamation-triangle';
        case 'warning': return 'exclamation-circle';
        default: return 'info-circle';
    }
}

function getToastTitle(type) {
    switch (type) {
        case 'success': return 'Ba≈üarƒ±lƒ±';
        case 'error': return 'Hata';
        case 'warning': return 'Uyarƒ±';
        default: return 'Bilgi';
    }
}

// Sayfa y√ºklendiƒüinde √ßalƒ±≈üacak kodlar
document.addEventListener('DOMContentLoaded', function() {
    updateBulkButtons();
});
</script>
{% endblock %}
