{% extends "base.html" %}

{% block title %}İstatistikler{% endblock %}

{% block content %}
<!-- Statistics Container with Scrollbar -->
<div class="statistics-container">
    <!-- Twitter Feed Style -->
    <div class="twitter-feed">
    <!-- Header -->
    <div class="feed-header">
        <div class="feed-header-content">
            <div class="feed-header-left">
                <h1 class="feed-title">İstatistikler</h1>
                <p class="feed-subtitle">AI Tweet Bot'unuzun performans analizi</p>
            </div>
            <div class="feed-header-right">
                <button onclick="location.reload();" class="twitter-btn twitter-btn-secondary">
                    <i class="fas fa-sync-alt"></i>
                    Yenile
                </button>
            </div>
        </div>
    </div>

    <!-- Ana İstatistik Kartları -->
    <div class="stats-grid">
        <!-- Aktif Makaleler -->
        <div class="stat-card stat-card-blue">
            <div class="stat-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.active_articles or 0 }}</div>
                <div class="stat-label">Aktif Makale</div>
                <div class="stat-subtitle">{{ stats.deleted_articles or 0 }} silinmiş</div>
            </div>
        </div>
        
        <!-- Paylaşılan Tweet -->
        <div class="stat-card stat-card-green">
            <div class="stat-icon">
                <i class="fab fa-twitter"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.posted_tweets or 0 }}</div>
                <div class="stat-label">Paylaşılan Tweet</div>
            </div>
        </div>
        
        <!-- Bekleyen Tweet -->
        <div class="stat-card stat-card-yellow">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.pending_tweets or 0 }}</div>
                <div class="stat-label">Bekleyen Tweet</div>
            </div>
        </div>
        
        <!-- Bugünkü Aktivite -->
        <div class="stat-card stat-card-purple">
            <div class="stat-icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.today_total_activity or 0 }}</div>
                <div class="stat-label">Bugünkü Aktivite</div>
            </div>
        </div>
        
        <!-- Silinmiş Tweetler -->
        <div class="stat-card stat-card-red">
            <div class="stat-icon">
                <i class="fas fa-trash-alt"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.deleted_tweets or 0 }}</div>
                <div class="stat-label">Silinmiş Tweet</div>
                <div class="stat-subtitle">Bugün: {{ stats.today_deleted or 0 }}</div>
            </div>
        </div>
        
        <!-- GitHub Repoları -->
        <div class="stat-card stat-card-dark">
            <div class="stat-icon">
                <i class="fab fa-github"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.github_repos_active or 0 }}</div>
                <div class="stat-label">GitHub Repo</div>
                <div class="stat-subtitle">Bugün: {{ stats.today_github or 0 }}</div>
            </div>
        </div>
        
        <!-- Haber Makaleleri -->
        <div class="stat-card stat-card-indigo">
            <div class="stat-icon">
                <i class="fas fa-globe"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.news_articles or 0 }}</div>
                <div class="stat-label">Haber Makalesi</div>
                <div class="stat-subtitle">Aktif haberler</div>
            </div>
        </div>
        
        <!-- En Popüler Dil -->
        <div class="stat-card stat-card-orange">
            <div class="stat-icon">
                <i class="fas fa-code"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.github_top_language[0] if stats.github_top_language else 'N/A' }}</div>
                <div class="stat-label">En Popüler Dil</div>
                <div class="stat-subtitle">{{ stats.github_top_language[1] if stats.github_top_language else 0 }} repo</div>
            </div>
        </div>
    </div>

    <!-- Detaylı İstatistikler -->
    <div class="stats-detail-grid">
        <!-- Günlük İstatistikler -->
        <div class="tweet-card">
            <div class="stats-section-header">
                <div class="stats-section-icon stats-section-icon-blue">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h2 class="stats-section-title">Günlük İstatistikler</h2>
            </div>
            
            {% if stats %}
                <div class="stats-content">
                    <div class="stats-row">
                        <div class="stats-item stats-item-blue">
                            <div class="stats-item-label">Bugün:</div>
                            <div class="stats-item-value">{{ stats.today_articles or 0 }} makale</div>
                        </div>
                        <div class="stats-item stats-item-green">
                            <div class="stats-item-label">Dün:</div>
                            <div class="stats-item-value">{{ stats.yesterday_articles or 0 }} makale</div>
                        </div>
                    </div>
                    
                    <div class="stats-divider"></div>
                    
                    <div class="stats-row">
                        <div class="stats-item stats-item-purple">
                            <div class="stats-item-label">Başarı oranı:</div>
                            <div class="stats-item-value">{{ "%.1f"|format(summary.success_rate or 0) }}%</div>
                        </div>
                        <div class="stats-item stats-item-gray">
                            <div class="stats-item-label">Son kontrol:</div>
                            <div class="stats-item-value">{{ summary.last_check_time or 'Henüz yok' }}</div>
                        </div>
                    </div>
                    
                    <!-- Bugünkü Detaylar -->
                    <div class="stats-divider"></div>
                    <h4 class="stats-subtitle">Bugünkü Aktivite Detayları</h4>
                    <div class="stats-detail-grid-small">
                        <div class="stats-detail-item stats-detail-indigo">
                            <div class="stats-detail-number">{{ stats.today_articles or 0 }}</div>
                            <div class="stats-detail-label">Paylaşılan</div>
                        </div>
                        <div class="stats-detail-item stats-detail-yellow">
                            <div class="stats-detail-number">{{ stats.today_pending or 0 }}</div>
                            <div class="stats-detail-label">Bekleyen</div>
                        </div>
                        <div class="stats-detail-item stats-detail-red">
                            <div class="stats-detail-number">{{ stats.today_deleted or 0 }}</div>
                            <div class="stats-detail-label">Silinmiş</div>
                        </div>
                        <div class="stats-detail-item stats-detail-gray">
                            <div class="stats-detail-number">{{ stats.today_github or 0 }}</div>
                            <div class="stats-detail-label">GitHub</div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="stats-empty">
                    <div class="stats-empty-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <p class="stats-empty-text">İstatistik verisi bulunamadı</p>
                </div>
            {% endif %}
        </div>
        
        <!-- GitHub Dil Dağılımı -->
        <div class="tweet-card">
            <div class="stats-section-header">
                <div class="stats-section-icon stats-section-icon-dark">
                    <i class="fab fa-github"></i>
                </div>
                <h2 class="stats-section-title">GitHub Dil Dağılımı</h2>
            </div>
            
            {% if stats and stats.github_languages %}
                <div class="stats-content">
                    <div class="language-list">
                        {% for language, count in stats.github_languages.items() %}
                        <div class="language-item">
                            <div class="language-info">
                                <div class="language-dot"></div>
                                <span class="language-name">{{ language }}</span>
                            </div>
                            <span class="language-count">{{ count }} repo</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <div class="stats-empty">
                    <div class="stats-empty-icon">
                        <i class="fab fa-github"></i>
                    </div>
                    <p class="stats-empty-text">GitHub repo verisi bulunamadı</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Silinmiş Tweetler ve Kaynak Türü Analizi -->
    <div class="stats-detail-grid">
        <!-- Silinmiş Tweetler Detayı -->
        <div class="tweet-card">
            <div class="stats-section-header">
                <div class="stats-section-icon stats-section-icon-red">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <h2 class="stats-section-title">Silinmiş Tweetler</h2>
            </div>
            
            <div class="stats-content">
                <div class="stats-row">
                    <div class="stats-item stats-item-red">
                        <div class="stats-item-label">Toplam Silinmiş:</div>
                        <div class="stats-item-value">{{ stats.deleted_tweets or 0 }}</div>
                    </div>
                    <div class="stats-item stats-item-orange">
                        <div class="stats-item-label">Bugün Silinmiş:</div>
                        <div class="stats-item-value">{{ stats.today_deleted or 0 }}</div>
                    </div>
                </div>
                
                <div class="stats-divider"></div>
                
                <div class="stats-row">
                    <div class="stats-item stats-item-gray">
                        <div class="stats-item-label">Aktif/Silinmiş:</div>
                        <div class="stats-item-value">
                            {{ stats.active_articles or 0 }}/{{ stats.deleted_tweets or 0 }}
                        </div>
                    </div>
                    <div class="stats-item stats-item-blue">
                        <div class="stats-item-label">Başarı Oranı:</div>
                        <div class="stats-item-value">
                            {% if (stats.active_articles or 0) + (stats.deleted_tweets or 0) > 0 %}
                                {{ "%.1f"|format(((stats.active_articles or 0) / ((stats.active_articles or 0) + (stats.deleted_tweets or 0))) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {% if stats.deleted_tweets and stats.deleted_tweets > 0 %}
                    <div class="stats-divider"></div>
                    <a href="{{ url_for('deleted_tweets') }}" class="stats-action-btn stats-action-btn-red">
                        <i class="fas fa-eye"></i>
                        <span>Silinmiş Tweetleri Görüntüle</span>
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Kaynak Türü Dağılımı -->
        <div class="tweet-card">
            <div class="stats-section-header">
                <div class="stats-section-icon stats-section-icon-indigo">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <h2 class="stats-section-title">Kaynak Türü Dağılımı</h2>
            </div>
            
            <div class="stats-content">
                <div class="source-list">
                    <!-- Haber Makaleleri -->
                    <div class="source-item source-item-news">
                        <div class="source-info">
                            <div class="source-dot source-dot-news"></div>
                            <span class="source-name">Haber Makaleleri</span>
                        </div>
                        <span class="source-count">{{ stats.news_articles or 0 }} makale</span>
                    </div>
                    
                    <!-- GitHub Repoları -->
                    <div class="source-item source-item-github">
                        <div class="source-info">
                            <div class="source-dot source-dot-github"></div>
                            <span class="source-name">GitHub Repoları</span>
                        </div>
                        <span class="source-count">{{ stats.github_repos_active or 0 }} repo</span>
                    </div>
                </div>
                
                <!-- Yüzdelik Dağılım -->
                {% if (stats.news_articles or 0) + (stats.github_repos_active or 0) > 0 %}
                    <div class="stats-divider"></div>
                    <h4 class="stats-subtitle">Yüzdelik Dağılım</h4>
                    {% set total_content = (stats.news_articles or 0) + (stats.github_repos_active or 0) %}
                    <div class="progress-section">
                        <div class="progress-item">
                            <div class="progress-label">
                                <span>Haber Makaleleri</span>
                                <span class="progress-percentage">{{ "%.1f"|format(((stats.news_articles or 0) / total_content) * 100) }}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-fill-news" data-width="{{ ((stats.news_articles or 0) / total_content) * 100 }}"></div>
                            </div>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-label">
                                <span>GitHub Repoları</span>
                                <span class="progress-percentage">{{ "%.1f"|format(((stats.github_repos_active or 0) / total_content) * 100) }}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-fill-github" data-width="{{ ((stats.github_repos_active or 0) / total_content) * 100 }}"></div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Özet Rapor -->
    {% if summary %}
    <div class="tweet-card">
        <div class="stats-section-header">
            <div class="stats-section-icon stats-section-icon-green">
                <i class="fas fa-file-alt"></i>
            </div>
            <h2 class="stats-section-title">Özet Rapor</h2>
        </div>
        
        <div class="stats-content">
            <div class="summary-grid">
                <div class="summary-card summary-card-green">
                    <h3 class="summary-title">En Yüksek Skorlu Makale</h3>
                    {% if summary.highest_scored %}
                        <p class="summary-text">{{ summary.highest_scored.title[:100] }}...</p>
                        <div class="summary-badge summary-badge-green">
                            Skor: {{ summary.highest_scored.score }}/10
                        </div>
                    {% else %}
                        <p class="summary-text">Veri bulunamadı</p>
                    {% endif %}
                </div>
                
                <div class="summary-card summary-card-blue">
                    <h3 class="summary-title">En Son Paylaşılan</h3>
                    {% if summary.latest_posted %}
                        <p class="summary-text">{{ summary.latest_posted.title[:100] }}...</p>
                        <div class="summary-badge summary-badge-blue">
                            {{ summary.latest_posted.posted_date[:10] if summary.latest_posted.posted_date else 'Tarih yok' }}
                        </div>
                    {% else %}
                        <p class="summary-text">Henüz paylaşılan tweet yok</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Veri Yönetimi -->
    <div class="tweet-card">
        <div class="stats-section-header">
            <div class="stats-section-icon stats-section-icon-danger">
                <i class="fas fa-database"></i>
            </div>
            <h2 class="stats-section-title">Veri Yönetimi</h2>
        </div>
        
        <div class="stats-content">
            <div class="data-management-grid">
                <!-- Dosya Boyutları -->
                <div class="data-section">
                    <h3 class="data-section-title">Dosya Boyutları</h3>
                    {% if stats %}
                        <div class="file-size-list">
                            <div class="file-size-item">
                                <span class="file-size-label">Makaleler:</span>
                                <span class="file-size-value">{{ stats.articles_file_size or 'N/A' }}</span>
                            </div>
                            <div class="file-size-item">
                                <span class="file-size-label">Bekleyen Tweet'ler:</span>
                                <span class="file-size-value">{{ stats.pending_file_size or 'N/A' }}</span>
                            </div>
                            <div class="file-size-item">
                                <span class="file-size-label">Ayarlar:</span>
                                <span class="file-size-value">{{ stats.settings_file_size or 'N/A' }}</span>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Tehlikeli İşlemler -->
                <div class="data-section">
                    <h3 class="data-section-title">Tehlikeli İşlemler</h3>
                    <div class="danger-actions">
                        <form method="POST" action="{{ url_for('reset_data') }}" onsubmit="return confirmReset()">
                            <button type="submit" class="danger-btn danger-btn-red">
                                <i class="fas fa-trash-alt"></i>
                                <span>Tüm Verileri Sıfırla</span>
                            </button>
                        </form>
                        
                        <a href="{{ url_for('clear_pending') }}" 
                           onclick="return confirm('Bekleyen tweet\'ler silinecek! Emin misiniz?')"
                           class="danger-btn danger-btn-yellow">
                            <i class="fas fa-broom"></i>
                            <span>Bekleyenleri Temizle</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Uyarı -->
            <div class="warning-box">
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="warning-content">
                    <h4 class="warning-title">Uyarı</h4>
                    <p class="warning-text">Veri sıfırlama işlemi geri alınamaz. Lütfen dikkatli olun.</p>
                </div>
            </div>
        </div>
    </div>
</div>

{% if error %}
<div class="tweet-card error-card">
    <div class="error-content">
        <i class="fas fa-exclamation-triangle"></i>
        <span class="error-text">Hata: {{ error }}</span>
    </div>
</div>
{% endif %}

<script>
function confirmReset() {
    const confirmation1 = confirm('⚠️ DİKKAT! Tüm veriler kalıcı olarak silinecek!\n\n• Tüm paylaşılan makaleler\n• Bekleyen tweet\'ler\n• İstatistikler\n• Ayarlar\n\nBu işlem GERİ ALINAMAZ!\n\nDevam etmek istediğinizden emin misiniz?');
    
    if (!confirmation1) return false;
    
    const confirmation2 = confirm('Son uyarı! Bu işlem tüm verilerinizi kalıcı olarak silecek.\n\nGerçekten devam etmek istiyor musunuz?');
    
    if (!confirmation2) return false;
    
    const userInput = prompt('Onaylamak için "SIFIRLA" yazın (büyük harflerle):');
    
    return userInput === 'SIFIRLA';
}

// Progress bar'ları dinamik olarak ayarla
document.addEventListener('DOMContentLoaded', function() {
    // Progress bar'ları animasyonlu olarak doldur
    const progressFills = document.querySelectorAll('.progress-fill');
    progressFills.forEach(fill => {
        const width = fill.getAttribute('data-width');
        setTimeout(() => {
            fill.style.width = width + '%';
        }, 500);
    });
});
</script>
    </div>
</div>
{% endblock %} 