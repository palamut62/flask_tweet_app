{% extends "base.html" %}

{% block title %}AI Tweet Bot - Güvenlik Kontrolü{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/twitter-style.css') }}">
{% endblock %}

{% block content %}
<!-- Security Header - Twitter Tarzı -->
<div class="security-header">
    <h1 class="security-title">
        <i class="fas fa-shield-alt"></i>
        🔒 Güvenlik Kontrolü
    </h1>
</div>

<div class="security-content">
    <p style="color: var(--twitter-text-secondary); margin-bottom: 20px; font-size: 14px;">
        Uygulamanızın güvenlik yapılandırmasını kontrol edin
    </p>

    {% if security %}
        <!-- Genel Durum -->
        <div class="security-status-card">
            <div class="security-status-header">
                <div class="security-status-icon {{ 'status-secure' if security.secure else 'status-warning' }}">
                    <i class="fas fa-{{ 'shield-alt' if security.secure else 'exclamation-triangle' }}"></i>
                </div>
                <div class="security-status-info">
                    <h2 class="security-status-title {{ 'status-secure' if security.secure else 'status-warning' }}">
                        {% if security.secure %}
                            ✅ Güvenlik Yapılandırması Uygun
                        {% else %}
                            ⚠️ Güvenlik Sorunları Tespit Edildi
                        {% endif %}
                    </h2>
                    <p class="security-status-description">
                        {% if security.secure %}
                            Tüm güvenlik kontrolleri başarılı
                        {% else %}
                            {{ security.issues|length }} güvenlik sorunu bulundu
                        {% endif %}
                    </p>
                    <!-- Güvenlik Skoru -->
                    <div class="security-score">
                        <div class="security-score-bar">
                            <div class="security-score-fill {{ 'score-high' if security.security_score >= 80 else 'score-medium' if security.security_score >= 60 else 'score-low' }}" 
                                 style="width: {{ security.security_score if security.security_score else 0 }}%"></div>
                        </div>
                        <span class="security-score-text {{ 'score-high' if security.security_score >= 80 else 'score-medium' if security.security_score >= 60 else 'score-low' }}">
                            {{ security.security_score }}% ({{ security.security_level }})
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Güvenlik İstatistikleri -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number stat-success">{{ security.passed_checks }}</div>
                <div class="stat-label">Başarılı Kontrol</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-danger">{{ security.issues|length }}</div>
                <div class="stat-label">Güvenlik Sorunu</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-info">{{ security.total_checks }}</div>
                <div class="stat-label">Toplam Kontrol</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-warning">{{ security.auth_method }}</div>
                <div class="stat-label">Giriş Yöntemi</div>
            </div>
        </div>

        <!-- Güvenlik Sorunları -->
        {% if security.issues %}
            <div class="security-issues-card">
                <div class="security-issues-header">
                    <h3 class="security-issues-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Güvenlik Sorunları ({{ security.issues|length }})
                    </h3>
                </div>
                <div class="security-issues-body">
                    <ul class="security-issues-list">
                        {% for issue in security.issues %}
                            <li class="security-issue-item">
                                <i class="fas fa-times-circle"></i>
                                <span>{{ issue }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}

        <!-- Sistem Bilgileri -->
        <div class="system-info-grid">
            <!-- Sistem Modu -->
            <div class="system-info-card">
                <div class="system-info-header">
                    <h3 class="system-info-title">
                        <i class="fas fa-cog"></i>
                        Sistem Modu
                    </h3>
                </div>
                <div class="system-info-body">
                    <div class="system-info-item">
                        <span class="system-info-label">Debug Modu:</span>
                        <span class="system-info-value {{ 'status-warning' if security.debug_mode else 'status-success' }}">
                            {{ 'Açık' if security.debug_mode else 'Kapalı' }}
                        </span>
                    </div>
                    <div class="system-info-item">
                        <span class="system-info-label">Flask Ortamı:</span>
                        <span class="system-info-value {{ 'status-success' if security.flask_env == 'production' else 'status-warning' }}">
                            {{ security.flask_env|title }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- E-posta OTP Sistemi -->
            <div class="system-info-card">
                <div class="system-info-header">
                    <h3 class="system-info-title">
                        <i class="fas fa-envelope"></i>
                        E-posta OTP
                    </h3>
                </div>
                <div class="system-info-body">
                    <div class="system-info-item">
                        <span class="system-info-label">Admin E-posta:</span>
                        <span class="system-info-value {{ 'status-success' if security.admin_email else 'status-danger' }}">
                            {{ 'Yapılandırılmış' if security.admin_email else 'Eksik' }}
                        </span>
                    </div>
                    <div class="system-info-item">
                        <span class="system-info-label">SMTP Yapılandırması:</span>
                        <span class="system-info-value {{ 'status-success' if security.email_configured else 'status-danger' }}">
                            {{ 'Aktif' if security.email_configured else 'Eksik' }}
                        </span>
                    </div>
                    {% if security.admin_email %}
                        <div class="system-info-email">
                            Admin: {{ security.admin_email[:3] }}***@{{ security.admin_email.split('@')[1] if '@' in security.admin_email else '***' }}
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Güvenlik Özellikleri -->
            <div class="system-info-card">
                <div class="system-info-header">
                    <h3 class="system-info-title">
                        <i class="fas fa-shield-alt"></i>
                        Güvenlik Özellikleri
                    </h3>
                </div>
                <div class="system-info-body">
                    <div class="system-info-item">
                        <span class="system-info-label">Güvenli Logging:</span>
                        <span class="system-info-value status-success">Aktif</span>
                    </div>
                    <div class="system-info-item">
                        <span class="system-info-label">API Maskeleme:</span>
                        <span class="system-info-value status-success">Aktif</span>
                    </div>
                    <div class="system-info-item">
                        <span class="system-info-label">OTP Doğrulama:</span>
                        <span class="system-info-value status-success">Aktif</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Güvenlik Önerileri -->
        <div class="security-recommendations-card">
            <div class="security-recommendations-header">
                <h3 class="security-recommendations-title">
                    <i class="fas fa-lightbulb"></i>
                    Güvenlik Önerileri
                </h3>
            </div>
            <div class="security-recommendations-body">
                <div class="recommendations-grid">
                    <ul class="recommendations-list">
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Environment variable'larınızı <code>.env</code> dosyasında saklayın</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Production'da <code>DEBUG=False</code> ayarlayın</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Gmail için <strong>App Password</strong> kullanın (normal şifre değil)</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Admin e-posta adresini güvenli tutun</span>
                        </li>
                    </ul>
                    <ul class="recommendations-list">
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>API anahtarlarınızı düzenli olarak yenileyin</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span><code>.env</code> dosyasını asla Git'e commit etmeyin</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>OTP kodlarını kimseyle paylaşmayın</span>
                        </li>
                        <li class="recommendation-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Güçlü ve benzersiz <code>SECRET_KEY</code> kullanın</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- E-posta OTP Kurulum Rehberi -->
        {% if not security.email_configured %}
            <div class="security-setup-card">
                <div class="security-setup-header">
                    <h3 class="security-setup-title">
                        <i class="fas fa-wrench"></i>
                        E-posta OTP Kurulum Rehberi
                    </h3>
                </div>
                <div class="security-setup-body">
                    <div class="setup-step">
                        <h4 class="setup-step-title">1. Gmail App Password Oluşturun:</h4>
                        <ol class="setup-step-list">
                            <li>Google hesabınızda 2FA'yı aktif edin</li>
                            <li><a href="https://myaccount.google.com/apppasswords" target="_blank" class="setup-link">Google App Passwords</a> sayfasına gidin</li>
                            <li>"AI Tweet Bot" için yeni app password oluşturun</li>
                            <li>Oluşturulan 16 haneli şifreyi kopyalayın</li>
                        </ol>
                    </div>
                    <div class="setup-step">
                        <h4 class="setup-step-title">2. Environment Variables'ları Ayarlayın:</h4>
                        <pre class="setup-code"><code>ADMIN_EMAIL=your-admin@gmail.com
EMAIL_ADDRESS=your-sender@gmail.com  
EMAIL_PASSWORD=your-16-digit-app-password
SECRET_KEY=your-very-long-secret-key-here</code></pre>
                    </div>
                </div>
            </div>
        {% endif %}

    {% else %}
        <div class="security-error-card">
            <div class="security-error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <h2 class="security-error-title">Güvenlik Kontrolü Yapılamadı</h2>
                <p class="security-error-description">Sistem yapılandırması kontrol edilemedi.</p>
            </div>
        </div>
    {% endif %}

    <!-- Geri Dön -->
    <div class="security-back-button">
        <a href="{{ url_for('settings') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Ayarlara Geri Dön
        </a>
    </div>
</div>
{% endblock %} 