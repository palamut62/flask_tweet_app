{% extends "base.html" %}

{% block title %}Silinmiş Tweetler{% endblock %}

{% block content %}
<!-- Deleted Tweets Container with Scrollbar -->
<div class="deleted-tweets-container">
    <!-- Twitter Feed Style -->
    <div class="twitter-feed">
    <!-- Header -->
    <div class="feed-header">
        <div class="feed-header-content">
            <div class="feed-header-left">
                <h1 class="feed-title">Silinmiş Tweetler</h1>
                <p class="feed-subtitle">Manuel olarak silinen veya reddedilen tweet'lerin listesi</p>
            </div>
            <div class="feed-header-right">
                <button onclick="location.reload();" class="twitter-btn twitter-btn-secondary">
                    <i class="fas fa-sync-alt"></i>
                    Yenile
                </button>
            </div>
        </div>
    </div>

    <!-- İstatistikler -->
    {% if stats %}
    <div class="tweet-card deleted-stats-card">
        <div class="deleted-stats-grid">
            <div class="deleted-stat-item">
                <div class="deleted-stat-number">{{ stats.total_deleted }}</div>
                <div class="deleted-stat-label">Toplam Silinmiş</div>
            </div>
            <div class="deleted-stat-item">
                <div class="deleted-stat-number">{{ stats.deleted_today }}</div>
                <div class="deleted-stat-label">Bugün Silinmiş</div>
            </div>
            <div class="deleted-stat-item">
                <div class="deleted-stat-number">{{ stats.deleted_this_week }}</div>
                <div class="deleted-stat-label">Bu Hafta</div>
            </div>
            <div class="deleted-stat-item">
                <div class="deleted-stat-number">{{ stats.deleted_this_month }}</div>
                <div class="deleted-stat-label">Bu Ay</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Hata Mesajı -->
    {% if error %}
    <div class="tweet-card error-card">
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="error-text">
                <strong>Hata:</strong> {{ error }}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Silinmiş Tweetler Listesi -->
    {% if deleted_articles %}
    <div class="deleted-tweets-container">
        {% for article in deleted_articles %}
        <div class="tweet-card deleted-tweet-card">
            <!-- Tweet Header -->
            <div class="deleted-tweet-header">
                <div class="deleted-tweet-avatar">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <div class="deleted-tweet-user-info">
                    <div class="deleted-tweet-user-name">Silinmiş Tweet</div>
                    <div class="deleted-tweet-user-handle">@deleted_tweet</div>
                </div>
                <div class="deleted-tweet-status-badges">
                    <span class="status-badge status-deleted">
                        <i class="fas fa-trash-alt"></i>
                        Silinmiş
                    </span>
                    {% if article.deleted_date %}
                    <span class="status-badge status-date">
                        <i class="fas fa-calendar"></i>
                        {{ article.deleted_date[:10] }}
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Tweet Content -->
            <div class="deleted-tweet-content">
                <div class="deleted-tweet-title">{{ article.title[:100] }}{% if article.title|length > 100 %}...{% endif %}</div>
                {% if article.tweet_text %}
                <div class="deleted-tweet-text">{{ article.tweet_text }}</div>
                {% endif %}
            </div>
            
            <!-- Silme Nedeni -->
            {% if article.deletion_reason %}
            <div class="deletion-reason-box">
                <div class="deletion-reason-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="deletion-reason-content">
                    <div class="deletion-reason-label">Silme Nedeni:</div>
                    <div class="deletion-reason-text">{{ article.deletion_reason }}</div>
                </div>
            </div>
            {% endif %}
            
            <!-- Tweet Footer -->
            <div class="deleted-tweet-footer">
                <!-- Tweet Bilgileri -->
                <div class="deleted-tweet-info-grid">
                    {% if article.url %}
                    <div class="deleted-tweet-info-item">
                        <i class="fas fa-link"></i>
                        <a href="{{ article.url }}" target="_blank" class="deleted-tweet-link">
                            {{ article.url[:50] }}{% if article.url|length > 50 %}...{% endif %}
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if article.source %}
                    <div class="deleted-tweet-info-item">
                        <i class="fas fa-rss"></i>
                        <span>{{ article.source }}</span>
                    </div>
                    {% endif %}
                    
                    {% if article.posted_date %}
                    <div class="deleted-tweet-info-item">
                        <i class="fas fa-clock"></i>
                        <span>{{ article.posted_date[:10] }}</span>
                    </div>
                    {% endif %}
                    
                    {% if article.impact_score %}
                    <div class="deleted-tweet-info-item">
                        <i class="fas fa-star"></i>
                        <span>{{ article.impact_score }}/10</span>
                    </div>
                    {% endif %}
                    
                    {% if article.hash %}
                    <div class="deleted-tweet-info-item">
                        <i class="fas fa-fingerprint"></i>
                        <span>{{ article.hash[:8] }}...</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Tweet Actions -->
                <div class="deleted-tweet-actions">
                    {% if article.url %}
                    <button class="deleted-tweet-action-btn" onclick="window.open('{{ article.url }}', '_blank')">
                        <i class="fas fa-external-link-alt"></i>
                        <span>Makaleyi Oku</span>
                    </button>
                    {% endif %}
                    
                    {% if article.hash %}
                    <button class="deleted-tweet-action-btn deleted-tweet-action-restore" onclick="restoreDeletedTweet('{{ article.hash }}')">
                        <i class="fas fa-undo"></i>
                        <span>Geri Yükle</span>
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Sayfalama Bilgisi -->
    {% if deleted_articles|length > 20 %}
    <div class="deleted-tweets-info">
        <div class="deleted-tweets-info-content">
            <i class="fas fa-info-circle"></i>
            <span>Toplam {{ deleted_articles|length }} silinmiş tweet gösteriliyor</span>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- Silinmiş Tweet Yok -->
    <div class="tweet-card empty-state">
        <div class="empty-state-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h3 class="empty-state-title">Henüz Silinmiş Tweet Yok</h3>
        <p class="empty-state-description">Şu ana kadar hiç tweet silinmemiş veya reddedilmemiş.</p>
        <p class="empty-state-subtitle">
            Tweet'ler manuel olarak silindiğinde veya onay aşamasında reddedildiğinde burada görünecek.
        </p>
        <a href="{{ url_for('index') }}" class="twitter-btn twitter-btn-primary">
            <i class="fas fa-home"></i>
            <span>Ana Sayfaya Dön</span>
        </a>
    </div>
    {% endif %}
</div>

<script>
// Toast notification system
function showToast(message, type = 'info') {
    // Create toast container if it doesn't exist
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        `;
        document.body.appendChild(toastContainer);
    }

    // Create toast element
    const toast = document.createElement('div');
    const icon = getToastIcon(type);
    const title = getToastTitle(type);
    
    toast.className = `toast toast-${type}`;
    toast.style.cssText = `
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 10px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: flex-start;
        gap: 12px;
        animation: slideIn 0.3s ease-out;
        max-width: 400px;
    `;
    
    toast.innerHTML = `
        <div style="flex-shrink: 0; font-size: 20px;">${icon}</div>
        <div style="flex: 1;">
            <div style="font-weight: 600; margin-bottom: 4px; color: #374151;">${title}</div>
            <div style="color: #6b7280; font-size: 14px;">${message}</div>
        </div>
        <button onclick="this.parentElement.remove()" style="
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            margin-left: 8px;
        ">&times;</button>
    `;
    
    toastContainer.appendChild(toast);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => toast.remove(), 300);
        }
    }, 5000);
}

function getToastIcon(type) {
    const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
    };
    return icons[type] || icons.info;
}

function getToastTitle(type) {
    const titles = {
        success: 'Başarılı',
        error: 'Hata',
        warning: 'Uyarı',
        info: 'Bilgi'
    };
    return titles[type] || titles.info;
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// Silinmiş tweet'i geri yükleme fonksiyonu
function restoreDeletedTweet(articleHash) {
    if (!confirm('Bu tweet\'i geri yüklemek istediğinizden emin misiniz? Tweet tekrar ana listede görünecek.')) {
        return;
    }
    
    showToast('Tweet geri yükleniyor...', 'info');
    
    fetch('/restore_deleted_tweet', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            article_hash: articleHash
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Tweet başarıyla geri yüklendi!', 'success');
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            showToast('Geri yükleme hatası: ' + (data.error || 'Bilinmeyen hata'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Geri yükleme sırasında bir hata oluştu!', 'error');
    });
}
</script>
    </div>
</div>
{% endblock %} 