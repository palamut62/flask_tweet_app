{% extends "base.html" %}

{% block title %}Tweet Oluştur{% endblock %}

{% block content %}
<div class="flex justify-center items-center min-h-[60vh]">
  <div class="w-full max-w-xl bg-white/90 rounded-2xl shadow-2xl p-8 border border-blue-100">
    <h2 class="text-2xl font-bold mb-2 text-center text-blue-700 flex items-center justify-center gap-2">
      <i class="fas fa-pen-nib"></i> Tweet Oluştur
    </h2>
    <div class="mb-6">
      <div class="flex border-b border-blue-200 mb-4">
        <button id="tab-text" class="flex-1 py-2 font-semibold text-blue-700 border-b-2 border-blue-500 transition-all duration-200">
          <i class="fas fa-keyboard mr-2"></i>Metinden Tweet
        </button>
        <button id="tab-image" class="flex-1 py-2 font-semibold text-gray-500 border-b-2 border-transparent hover:text-blue-600 transition-all duration-200">
          <i class="fas fa-image mr-2"></i>Resimden Tweet
        </button>
        <button id="tab-link" class="flex-1 py-2 font-semibold text-gray-500 border-b-2 border-transparent hover:text-blue-600 transition-all duration-200">
          <i class="fas fa-link mr-2"></i>Link'ten Tweet
        </button>
      </div>

      <form method="POST" enctype="multipart/form-data" class="space-y-4">
        <input type="hidden" name="tweet_mode" id="tweet_mode" value="text">
        
        <!-- Metinden Tweet Sekmesi -->
        <div id="text-content" class="tab-content">
          <div class="space-y-4">
            <div>
              <label for="tweet_text" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-edit text-blue-500"></i> Tweet Metni
              </label>
              <textarea 
                name="tweet_text" 
                id="tweet_text" 
                rows="4" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                placeholder="Tweet için metin girin... AI ile optimize edilecek."
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Resimden Tweet Sekmesi -->
        <div id="image-content" class="tab-content hidden">
          <div class="space-y-4">
            <div>
              <label for="tweet_image" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-upload text-blue-500"></i> Resim Yükle
              </label>
              <input 
                type="file" 
                name="tweet_image" 
                id="tweet_image" 
                accept="image/*"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
              <p class="text-sm text-gray-500 mt-2">
                <i class="fas fa-info-circle"></i> Resimden metin çıkarılıp AI ile tweet oluşturulacak
              </p>
            </div>
          </div>
        </div>

        <!-- Link'ten Tweet Sekmesi -->
        <div id="link-content" class="tab-content hidden">
          <div class="space-y-4">
            <div>
              <label for="tweet_url" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-globe text-blue-500"></i> Web Sitesi URL'si
              </label>
              <input 
                type="url" 
                name="tweet_url" 
                id="tweet_url" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="https://example.com/article"
              >
              <p class="text-sm text-gray-500 mt-2">
                <i class="fas fa-info-circle"></i> Link içeriği MCP ile çekilip AI ile tweet oluşturulacak
              </p>
            </div>
          </div>
        </div>

        <div class="flex justify-center pt-4">
          <button 
            type="submit" 
            class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg flex items-center gap-2"
          >
            <i class="fas fa-magic"></i>
            <span>Tweet Oluştur</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Oluşturulan Tweet Önizlemesi -->
    {% if generated_tweet %}
    <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
        <i class="fas fa-eye text-blue-500"></i> Oluşturulan Tweet
      </h3>
      <div class="bg-white p-4 rounded-lg border border-gray-300 mb-3">
        <p class="text-gray-800 whitespace-pre-wrap">{{ generated_tweet }}</p>
        <div class="text-sm text-gray-500 mt-2">
          <i class="fas fa-info-circle"></i> Karakter sayısı: {{ generated_tweet|length }}/280
        </div>
      </div>
      <div class="flex gap-3">
        <button 
          onclick="copyTweet()" 
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fas fa-copy"></i> Kopyala
        </button>
        <a 
          href="https://twitter.com/intent/tweet?text={{ generated_tweet|urlencode }}" 
          target="_blank"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fab fa-twitter"></i> Twitter'da Paylaş
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
// Tab değiştirme fonksiyonları
function switchTab(activeTab, activeContent) {
  // Tüm tab'ları pasif yap
  document.querySelectorAll('[id^="tab-"]').forEach(tab => {
    tab.classList.add('text-gray-500', 'border-transparent');
    tab.classList.remove('text-blue-700', 'border-blue-500');
  });
  
  // Tüm içerikleri gizle
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.add('hidden');
  });
  
  // Aktif tab'ı göster
  activeTab.classList.add('text-blue-700', 'border-blue-500');
  activeTab.classList.remove('text-gray-500', 'border-transparent');
  
  // Aktif içeriği göster
  activeContent.classList.remove('hidden');
}

// Tab event listener'ları
document.getElementById('tab-text').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'text';
  switchTab(this, document.getElementById('text-content'));
});

document.getElementById('tab-image').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'image';
  switchTab(this, document.getElementById('image-content'));
});

document.getElementById('tab-link').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'link';
  switchTab(this, document.getElementById('link-content'));
});

// Tweet kopyalama
function copyTweet() {
  const tweetText = `{{ generated_tweet|safe }}`;
  navigator.clipboard.writeText(tweetText).then(function() {
    // Başarı mesajı
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> Kopyalandı!';
    button.classList.remove('bg-green-600', 'hover:bg-green-700');
    button.classList.add('bg-green-800');
    
    setTimeout(function() {
      button.innerHTML = originalText;
      button.classList.remove('bg-green-800');
      button.classList.add('bg-green-600', 'hover:bg-green-700');
    }, 2000);
  }).catch(function(err) {
    alert('Kopyalama başarısız: ' + err);
  });
}
</script>
{% endblock %} 