{% extends "base.html" %}

{% block title %}Tweet OluÅŸtur{% endblock %}

{% block content %}
<div class="flex justify-center items-center min-h-[60vh]">
  <div class="w-full max-w-4xl bg-white/90 rounded-2xl shadow-2xl p-8 border border-blue-100">
    <h2 class="text-2xl font-bold mb-2 text-center text-blue-700 flex items-center justify-center gap-2">
      <i class="fas fa-pen-nib"></i> Tweet OluÅŸtur
    </h2>
    
    <!-- Tweet Tema SeÃ§imi -->
    <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
      <label for="tweet_theme" class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-palette text-blue-500"></i> Tweet TemasÄ±
      </label>
             <select id="tweet_theme" name="tweet_theme" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         <option value="bilgilendirici" {% if default_theme == 'bilgilendirici' or not default_theme %}selected{% endif %}>ðŸ“Š Bilgilendirici - Profesyonel ve eÄŸitici</option>
         <option value="eÄŸlenceli" {% if default_theme == 'eÄŸlenceli' %}selected{% endif %}>ðŸŽ‰ EÄŸlenceli - NeÅŸeli ve heyecanlÄ±</option>
         <option value="mizahi" {% if default_theme == 'mizahi' %}selected{% endif %}>ðŸ˜‚ Mizahi - Komik ve esprili</option>
         <option value="resmi" {% if default_theme == 'resmi' %}selected{% endif %}>ðŸ“¢ Resmi - Ciddi ve otoriteye dayalÄ±</option>
         <option value="heyecanlÄ±" {% if default_theme == 'heyecanlÄ±' %}selected{% endif %}>ðŸ”¥ HeyecanlÄ± - Dinamik ve ilham verici</option>
         <option value="meraklÄ±" {% if default_theme == 'meraklÄ±' %}selected{% endif %}>ðŸ¤” MeraklÄ± - SorgulayÄ±cÄ± ve dÃ¼ÅŸÃ¼ndÃ¼rÃ¼cÃ¼</option>
       </select>
      <p class="text-sm text-gray-500 mt-1">
        <i class="fas fa-info-circle"></i> SeÃ§ilen temaya gÃ¶re tweet tarzÄ±, emoji ve hashtag'ler otomatik ayarlanacak
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Sol Taraf - Tweet OluÅŸturma -->
      <div>
        <div class="mb-6">
          <div class="flex border-b border-blue-200 mb-4">
            <button id="tab-text" class="flex-1 py-2 font-semibold text-blue-700 border-b-2 border-blue-500 transition-all duration-200">
              <i class="fas fa-keyboard mr-2"></i>Metinden Tweet
            </button>
            <button id="tab-image" class="flex-1 py-2 font-semibold text-gray-500 border-b-2 border-transparent hover:text-blue-600 transition-all duration-200">
              <i class="fas fa-image mr-2"></i>Resimden Tweet
            </button>
            <button id="tab-link" class="flex-1 py-2 font-semibold text-gray-500 border-b-2 border-transparent hover:text-blue-600 transition-all duration-200">
              <i class="fas fa-link mr-2"></i>Link'ten Tweet
            </button>
          </div>

          <form method="POST" enctype="multipart/form-data" class="space-y-4" id="tweet-form">
            <input type="hidden" name="tweet_mode" id="tweet_mode" value="text">
            <input type="hidden" name="tweet_theme" id="hidden_tweet_theme" value="bilgilendirici">
            
            <!-- Metinden Tweet Sekmesi -->
            <div id="text-content" class="tab-content">
              <div class="space-y-4">
                <div>
                  <label for="tweet_text" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-edit text-blue-500"></i> Tweet Metni
                  </label>
                  <textarea 
                                         name="tweet_text" 
                     id="tweet_text" 
                     rows="4" 
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                     placeholder="Tweet iÃ§in metin girin... AI ile optimize edilecek."
                  ></textarea>
                  <div class="flex justify-between items-center mt-2">
                    <span class="text-sm text-gray-500">
                      <i class="fas fa-info-circle"></i> AI ile optimize edilecek
                    </span>
                    <span id="text-char-count" class="text-sm text-gray-500">0 karakter</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resimden Tweet Sekmesi -->
            <div id="image-content" class="tab-content hidden">
              <div class="space-y-4">
                <div>
                  <label for="tweet_image" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-upload text-blue-500"></i> Resim YÃ¼kle
                  </label>
                  <input 
                    type="file" 
                    name="tweet_image" 
                    id="tweet_image" 
                    accept="image/jpeg,image/png,image/gif,image/webp"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    onchange="previewImage(this)"
                  >
                  <p class="text-sm text-gray-500 mt-2">
                    <i class="fas fa-info-circle"></i> Desteklenen formatlar: JPEG, PNG, GIF, WebP (Max: 5MB)
                  </p>
                  <!-- Resim Ã–nizlemesi -->
                  <div id="image-preview" class="hidden mt-4">
                    <img id="preview-img" src="" alt="Ã–nizleme" class="max-w-full h-48 object-contain border border-gray-300 rounded-lg">
                    <button type="button" onclick="removeImage()" class="mt-2 px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                      <i class="fas fa-times"></i> KaldÄ±r
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Link'ten Tweet Sekmesi -->
            <div id="link-content" class="tab-content hidden">
              <div class="space-y-4">
                <div>
                  <label for="tweet_url" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-globe text-blue-500"></i> Web Sitesi URL'si
                  </label>
                  <input 
                    type="url" 
                    name="tweet_url" 
                    id="tweet_url" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                         placeholder="https://example.com/article"
                  >
                  <div id="url-status" class="mt-2 text-sm hidden"></div>
                  <p class="text-sm text-gray-500 mt-2">
                    <i class="fas fa-info-circle"></i> Link iÃ§eriÄŸi MCP ile Ã§ekilip AI ile tweet oluÅŸturulacak
                  </p>
                  <!-- URL Ã–nizlemesi -->
                  <div id="url-preview" class="hidden mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                    <div class="flex items-start space-x-3">
                      <div class="flex-1">
                        <h4 id="url-title" class="font-medium text-gray-900"></h4>
                        <p id="url-description" class="text-sm text-gray-600 mt-1"></p>
                        <p id="url-domain" class="text-xs text-gray-500 mt-1"></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex justify-center pt-4">
              <button 
                type="submit" 
                id="submit-btn"
                class="px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg flex items-center gap-2"
              >
                <i class="fas fa-magic" id="submit-icon"></i>
                <span id="submit-text">Tweet OluÅŸtur</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- SaÄŸ Taraf - Ã–nizleme ve Ã–zellikler -->
      <div>
        <!-- Tema Ã–nizlemesi -->
        <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <i class="fas fa-eye text-blue-500"></i> Tema Ã–nizlemesi
          </h3>
          <div id="theme-preview" class="bg-white p-4 rounded-lg border border-gray-300">
            <div class="flex items-center gap-2 mb-2">
              <span id="theme-emoji">ðŸ“Š</span>
              <span id="theme-name" class="font-medium">Bilgilendirici</span>
            </div>
            <p id="theme-description" class="text-sm text-gray-600 mb-2">
              Profesyonel ve eÄŸitici tarzda tweet'ler oluÅŸturur
            </p>
            <div class="text-xs text-gray-500">
              <span id="theme-hashtags">#AI #Tech #Innovation</span>
            </div>
          </div>
        </div>

        <!-- GerÃ§ek ZamanlÄ± Tweet Ã–nizlemesi -->
        <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <i class="fas fa-twitter text-blue-500"></i> Tweet Ã–nizlemesi
          </h3>
          <div id="live-preview" class="bg-white p-4 rounded-lg border border-gray-300 min-h-[100px]">
            <div class="flex items-start space-x-3">
              <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                AI
              </div>
              <div class="flex-1">
                <div class="flex items-center space-x-2 mb-1">
                  <span class="font-bold text-gray-900">AI Tweet Bot</span>
                  <span class="text-blue-500"><i class="fas fa-check-circle"></i></span>
                  <span class="text-gray-500 text-sm">@ai_tweet_bot</span>
                </div>
                <p id="preview-text" class="text-gray-700 whitespace-pre-wrap">
                  Tweet metni buraya gelecek...
                </p>
                <div class="flex justify-between items-center mt-3 text-gray-500 text-sm">
                  <div class="flex space-x-4">
                    <span><i class="far fa-comment"></i> 0</span>
                    <span><i class="fas fa-retweet"></i> 0</span>
                    <span><i class="far fa-heart"></i> 0</span>
                    <span><i class="fas fa-share"></i></span>
                  </div>
                  <span id="preview-char-count" class="text-xs">0/280</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tweet Kalitesi GÃ¶stergesi -->
        <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <i class="fas fa-chart-line text-green-500"></i> Tweet Kalitesi
          </h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Karakter KullanÄ±mÄ±</span>
              <div class="flex items-center space-x-2">
                <div class="w-20 h-2 bg-gray-200 rounded-full">
                  <div id="char-progress" class="h-2 bg-blue-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <span id="char-percentage" class="text-xs text-gray-500">0%</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Hashtag SayÄ±sÄ±</span>
              <span id="hashtag-count" class="text-sm font-medium">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Emoji SayÄ±sÄ±</span>
              <span id="emoji-count" class="text-sm font-medium">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- OluÅŸturulan Tweet Sonucu -->
    {% if generated_tweet %}
    <div class="mt-8 p-6 bg-green-50 rounded-lg border border-green-200">
      <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
        <i class="fas fa-check-circle text-green-500"></i> Tweet BaÅŸarÄ±yla OluÅŸturuldu!
      </h3>
      
      <!-- Tweet Metni -->
      <div class="bg-white p-4 rounded-lg border border-gray-300 mb-4">
        <p class="text-gray-800 whitespace-pre-wrap">{{ generated_tweet }}</p>
        <div class="flex justify-between items-center mt-3 text-sm text-gray-500">
          <span><i class="fas fa-info-circle"></i> Karakter sayÄ±sÄ±: {{ generated_tweet|length }}/280</span>
          <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">
            {% if generated_tweet|length <= 240 %}Optimal{% elif generated_tweet|length <= 270 %}Ä°yi{% else %}Limit YakÄ±n{% endif %}
          </span>
        </div>
      </div>
      
      <!-- Aksiyon ButonlarÄ± -->
      <div class="flex flex-wrap gap-3">
        <button 
          onclick="copyTweet()" 
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fas fa-copy"></i> Kopyala
        </button>
        <a 
          href="https://twitter.com/intent/tweet?text={{ generated_tweet|urlencode }}" 
          target="_blank"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fab fa-twitter"></i> Twitter'da PaylaÅŸ
        </a>
        <button 
          onclick="editTweet()" 
          class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fas fa-edit"></i> DÃ¼zenle
        </button>
        <button 
          onclick="generateVariation()" 
          class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-all duration-200 flex items-center gap-2"
        >
          <i class="fas fa-sync-alt"></i> FarklÄ± Varyasyon
        </button>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<!-- Loading Modal -->
<div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
      <h3 class="text-lg font-semibold text-gray-900 mb-2">Tweet OluÅŸturuluyor</h3>
      <p id="loading-text" class="text-gray-600">AI ile tweet metni hazÄ±rlanÄ±yor...</p>
      <div class="mt-4 bg-gray-200 rounded-full h-2">
        <div id="loading-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
      </div>
    </div>
  </div>
</div>

<script>
// Global deÄŸiÅŸkenler
let currentTheme = '{{ default_theme|default("bilgilendirici") }}';
let isGenerating = false;

// Tema bilgileri
const themeData = {
  'bilgilendirici': {
    emoji: 'ðŸ“Š',
    name: 'Bilgilendirici',
    description: 'Profesyonel ve eÄŸitici tarzda tweet\'ler oluÅŸturur',
    hashtags: '#AI #Tech #Innovation #Technology',
    color: 'blue'
  },
  'eÄŸlenceli': {
    emoji: 'ðŸŽ‰',
    name: 'EÄŸlenceli',
    description: 'NeÅŸeli ve heyecanlÄ± tarzda tweet\'ler oluÅŸturur',
    hashtags: '#TechFun #Innovation #Cool #Amazing',
    color: 'green'
  },
  'mizahi': {
    emoji: 'ðŸ˜‚',
    name: 'Mizahi',
    description: 'Komik ve esprili tarzda tweet\'ler oluÅŸturur',
    hashtags: '#TechHumor #AILife #TechJokes #FunnyTech',
    color: 'yellow'
  },
  'resmi': {
    emoji: 'ðŸ“¢',
    name: 'Resmi',
    description: 'Ciddi ve otoriteye dayalÄ± tarzda tweet\'ler oluÅŸturur',
    hashtags: '#TechNews #Industry #Business #Official',
    color: 'gray'
  },
  'heyecanlÄ±': {
    emoji: 'ðŸ”¥',
    name: 'HeyecanlÄ±',
    description: 'Dinamik ve ilham verici tarzda tweet\'ler oluÅŸturur',
    hashtags: '#Breakthrough #GameChanger #Innovation #Exciting',
    color: 'red'
  },
  'meraklÄ±': {
    emoji: 'ðŸ¤”',
    name: 'MeraklÄ±',
    description: 'SorgulayÄ±cÄ± ve dÃ¼ÅŸÃ¼ndÃ¼rÃ¼cÃ¼ tarzda tweet\'ler oluÅŸturur',
    hashtags: '#TechCuriosity #WhatIf #Thinking #Questions',
    color: 'purple'
  }
};

// Sayfa yÃ¼klendiÄŸinde
document.addEventListener('DOMContentLoaded', function() {
  // Tema dropdown'Ä±ndan mevcut deÄŸeri al
  const themeSelect = document.getElementById('tweet_theme');
  if (themeSelect) {
    currentTheme = themeSelect.value;
    document.getElementById('hidden_tweet_theme').value = currentTheme;
  }
  
  updateThemePreview();
  
  // Tema deÄŸiÅŸikliÄŸi dinleyicisi
  document.getElementById('tweet_theme').addEventListener('change', function() {
    currentTheme = this.value;
    document.getElementById('hidden_tweet_theme').value = currentTheme;
    updateThemePreview();
  });
  
  // Tweet text input dinleyicisi - Ã–nizleme iÃ§in
  const tweetTextArea = document.getElementById('tweet_text');
  if (tweetTextArea) {
    tweetTextArea.addEventListener('input', function() {
      updateCharacterCount(this);
    });
    
    // Ä°lk yÃ¼klemede boÅŸ Ã¶nizleme gÃ¶ster
    updateLivePreview('');
  }
  
  // URL input dinleyicisi
  const tweetUrlInput = document.getElementById('tweet_url');
  if (tweetUrlInput) {
    tweetUrlInput.addEventListener('input', function() {
      validateUrl(this);
    });
  }
  
  // Form gÃ¶nderimi dinleyicisi
  document.getElementById('tweet-form').addEventListener('submit', function(e) {
    if (isGenerating) {
      e.preventDefault();
      return;
    }
    
    showLoadingModal();
    isGenerating = true;
    
    // Submit butonunu devre dÄ±ÅŸÄ± bÄ±rak
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
  });
});

// Tema Ã¶nizlemesini gÃ¼ncelle
function updateThemePreview() {
  const theme = themeData[currentTheme];
  if (theme) {
    document.getElementById('theme-emoji').textContent = theme.emoji;
    document.getElementById('theme-name').textContent = theme.name;
    document.getElementById('theme-description').textContent = theme.description;
    document.getElementById('theme-hashtags').textContent = theme.hashtags;
  }
}

// Karakter sayacÄ±nÄ± gÃ¼ncelle
function updateCharacterCount(element) {
  try {
    const count = element.value.length;
    const countElement = document.getElementById('text-char-count');
    
    if (countElement) {
      countElement.textContent = `${count} karakter`;
      
      // Renk deÄŸiÅŸimi
      if (count > 250) {
        countElement.className = 'text-sm text-red-500 font-medium';
      } else if (count > 200) {
        countElement.className = 'text-sm text-yellow-500 font-medium';
      } else {
        countElement.className = 'text-sm text-gray-500';
      }
    }
    
    // Ã–nizlemeyi gÃ¼ncelle
    updateLivePreview(element.value);
    
    console.log('Karakter sayÄ±sÄ± gÃ¼ncellendi:', count); // Debug log
    
  } catch (error) {
    console.error('Karakter sayacÄ± gÃ¼ncelleme hatasÄ±:', error);
  }
}

// CanlÄ± Ã¶nizlemeyi gÃ¼ncelle
function updateLivePreview(text) {
  try {
    const previewElement = document.getElementById('preview-text');
    const charCountElement = document.getElementById('preview-char-count');
    const charProgressElement = document.getElementById('char-progress');
    const charPercentageElement = document.getElementById('char-percentage');
    
    // Element kontrolÃ¼
    if (!previewElement || !charCountElement || !charProgressElement || !charPercentageElement) {
      console.warn('Tweet Ã¶nizleme elementleri bulunamadÄ±');
      return;
    }
    
    // Metin Ã¶nizlemesi
    if (text && text.trim()) {
      previewElement.textContent = text;
    } else {
      previewElement.textContent = 'Tweet metni buraya gelecek...';
      previewElement.style.color = '#9CA3AF'; // Placeholder rengi
    }
    
    const charCount = text ? text.length : 0;
    const percentage = Math.min((charCount / 280) * 100, 100);
    
    // Karakter sayÄ±sÄ±nÄ± gÃ¼ncelle
    charCountElement.textContent = `${charCount}/280`;
    charProgressElement.style.width = `${percentage}%`;
    charPercentageElement.textContent = `${Math.round(percentage)}%`;
    
    // Progress bar rengi ve karakter sayÄ±sÄ± rengi
    if (percentage > 95) {
      charProgressElement.className = 'h-2 bg-red-600 rounded-full transition-all duration-300';
      charCountElement.style.color = '#DC2626'; // KÄ±rmÄ±zÄ±
    } else if (percentage > 85) {
      charProgressElement.className = 'h-2 bg-orange-500 rounded-full transition-all duration-300';
      charCountElement.style.color = '#EA580C'; // Turuncu
    } else if (percentage > 75) {
      charProgressElement.className = 'h-2 bg-yellow-500 rounded-full transition-all duration-300';
      charCountElement.style.color = '#CA8A04'; // SarÄ±
    } else {
      charProgressElement.className = 'h-2 bg-blue-500 rounded-full transition-all duration-300';
      charCountElement.style.color = '#6B7280'; // Gri
    }
    
    // Hashtag ve emoji sayÄ±sÄ±nÄ± gÃ¼ncelle
    const hashtagCount = text ? (text.match(/#\w+/g) || []).length : 0;
    const emojiCount = text ? (text.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu) || []).length : 0;
    
    const hashtagElement = document.getElementById('hashtag-count');
    const emojiElement = document.getElementById('emoji-count');
    
    if (hashtagElement) hashtagElement.textContent = hashtagCount;
    if (emojiElement) emojiElement.textContent = emojiCount;
    
    // Metin varsa placeholder rengini kaldÄ±r
    if (text && text.trim()) {
      previewElement.style.color = '#374151'; // Normal metin rengi
    }
    
  } catch (error) {
    console.error('Tweet Ã¶nizleme gÃ¼ncelleme hatasÄ±:', error);
  }
}

// Tab deÄŸiÅŸtirme fonksiyonlarÄ±
function switchTab(activeTab, activeContent) {
  // TÃ¼m tab'larÄ± pasif yap
  document.querySelectorAll('[id^="tab-"]').forEach(tab => {
    tab.classList.add('text-gray-500', 'border-transparent');
    tab.classList.remove('text-blue-700', 'border-blue-500');
  });
  
  // TÃ¼m iÃ§erikleri gizle
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.add('hidden');
  });
  
  // Aktif tab'Ä± gÃ¶ster
  activeTab.classList.add('text-blue-700', 'border-blue-500');
  activeTab.classList.remove('text-gray-500', 'border-transparent');
  
  // Aktif iÃ§eriÄŸi gÃ¶ster
  activeContent.classList.remove('hidden');
}

// Tab event listener'larÄ±
document.getElementById('tab-text').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'text';
  switchTab(this, document.getElementById('text-content'));
});

document.getElementById('tab-image').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'image';
  switchTab(this, document.getElementById('image-content'));
});

document.getElementById('tab-link').addEventListener('click', function() {
  document.getElementById('tweet_mode').value = 'link';
  switchTab(this, document.getElementById('link-content'));
});

// Resim Ã¶nizleme
function previewImage(input) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    
    // Dosya boyutu kontrolÃ¼ (5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert('Dosya boyutu 5MB\'dan bÃ¼yÃ¼k olamaz!');
      input.value = '';
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('preview-img').src = e.target.result;
      document.getElementById('image-preview').classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  }
}

// Resim kaldÄ±rma
function removeImage() {
  document.getElementById('tweet_image').value = '';
  document.getElementById('image-preview').classList.add('hidden');
}

// URL doÄŸrulama
function validateUrl(input) {
  const url = input.value.trim();
  const statusElement = document.getElementById('url-status');
  
  if (!url) {
    statusElement.classList.add('hidden');
    return;
  }
  
  try {
    new URL(url);
    statusElement.className = 'mt-2 text-sm text-green-600';
    statusElement.innerHTML = '<i class="fas fa-check-circle"></i> GeÃ§erli URL';
    statusElement.classList.remove('hidden');
    
    // URL Ã¶nizlemesi iÃ§in basit bilgi gÃ¶ster
    const domain = new URL(url).hostname;
    document.getElementById('url-domain').textContent = domain;
    document.getElementById('url-title').textContent = 'URL Ã–nizlemesi';
    document.getElementById('url-description').textContent = 'Ä°Ã§erik Ã§ekilecek ve AI ile tweet oluÅŸturulacak';
    document.getElementById('url-preview').classList.remove('hidden');
    
  } catch (e) {
    statusElement.className = 'mt-2 text-sm text-red-600';
    statusElement.innerHTML = '<i class="fas fa-exclamation-circle"></i> GeÃ§ersiz URL formatÄ±';
    statusElement.classList.remove('hidden');
    document.getElementById('url-preview').classList.add('hidden');
  }
}

// Loading modal gÃ¶ster
function showLoadingModal() {
  document.getElementById('loading-modal').classList.remove('hidden');
  
  // Progress bar animasyonu
  let progress = 0;
  const progressBar = document.getElementById('loading-progress');
  const loadingText = document.getElementById('loading-text');
  
  const messages = [
    'AI ile tweet metni hazÄ±rlanÄ±yor...',
    'Ä°Ã§erik analiz ediliyor...',
    'Tema Ã¶zellikleri uygulanÄ±yor...',
    'Tweet optimize ediliyor...',
    'Son kontroller yapÄ±lÄ±yor...'
  ];
  
  let messageIndex = 0;
  
  const interval = setInterval(() => {
    progress += 20;
    progressBar.style.width = `${progress}%`;
    
    if (messageIndex < messages.length) {
      loadingText.textContent = messages[messageIndex];
      messageIndex++;
    }
    
    if (progress >= 100) {
      clearInterval(interval);
    }
  }, 800);
}

// Loading modal gizle
function hideLoadingModal() {
  document.getElementById('loading-modal').classList.add('hidden');
  
  // Submit butonunu tekrar aktif et
  const submitBtn = document.getElementById('submit-btn');
  submitBtn.disabled = false;
  submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
  isGenerating = false;
}

// Tweet kopyalama
function copyTweet() {
  const tweetText = `{{ generated_tweet|safe }}`;
  navigator.clipboard.writeText(tweetText).then(function() {
    // BaÅŸarÄ± mesajÄ±
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> KopyalandÄ±!';
    button.classList.remove('bg-green-600', 'hover:bg-green-700');
    button.classList.add('bg-green-800');
    
    setTimeout(function() {
      button.innerHTML = originalText;
      button.classList.remove('bg-green-800');
      button.classList.add('bg-green-600', 'hover:bg-green-700');
    }, 2000);
  }).catch(function(err) {
    alert('Kopyalama baÅŸarÄ±sÄ±z: ' + err);
  });
}

// Tweet dÃ¼zenleme
function editTweet() {
  const tweetText = `{{ generated_tweet|safe }}`;
  document.getElementById('tweet_text').value = tweetText;
  document.getElementById('tab-text').click();
  updateCharacterCount(document.getElementById('tweet_text'));
  
  // SayfayÄ± yukarÄ± kaydÄ±r
  document.querySelector('h2').scrollIntoView({ behavior: 'smooth' });
}

// FarklÄ± varyasyon oluÅŸtur
function generateVariation() {
  if (confirm('AynÄ± iÃ§erik iÃ§in farklÄ± bir tweet varyasyonu oluÅŸturmak istiyor musunuz?')) {
    // Form'u tekrar gÃ¶nder
    document.getElementById('tweet-form').submit();
  }
}

// Sayfa yÃ¼klendiÄŸinde loading modal'Ä± gizle
window.addEventListener('load', function() {
  hideLoadingModal();
});
</script>
{% endblock %} 